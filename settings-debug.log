2025-08-14 11:47:07,393 INFO settings SERVICE_ACCOUNT_KEY_PATH is set to: C:\Users\NathanNeely\Projects\config\ora-automation-project-dev-25acb5551197.json
2025-08-14 11:47:07,393 INFO settings File exists: True
2025-08-14 11:47:07,394 INFO settings First 100 chars of key file: {
  "type": "service_account",
  "project_id": "ora-automation-project-dev",
  "private_key_id": "25
2025-08-14 11:47:07,739 INFO __main__ --- Starting Daily Shipment Processor ---
2025-08-14 11:47:07,740 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Key from Secret Manager...
2025-08-14 11:47:08,068 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-key'.
2025-08-14 11:47:08,068 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Secret from Secret Manager...
2025-08-14 11:47:08,320 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-secret'.
2025-08-14 11:47:08,321 INFO __main__ Using rolling 32-day date range: 2025-07-13 to 2025-08-14
2025-08-14 11:47:08,321 INFO src.services.shipstation.api_client Starting raw shipment fetch from 2025-07-13 with includeShipmentItems=true and status='shipped'...
2025-08-14 11:47:08,322 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 11:47:09,199 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 11:47:09,209 INFO src.services.shipstation.api_client Fetched page 1 of 2. Total shipments so far: 500
2025-08-14 11:47:09,209 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 11:47:09,711 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 11:47:09,715 INFO src.services.shipstation.api_client Fetched page 2 of 2. Total shipments so far: 676
2025-08-14 11:47:09,715 INFO src.services.shipstation.api_client Finished fetching ShipStation shipments. Total retrieved: 676
2025-08-14 11:47:09,717 INFO __main__ Processing 675 non-voided shipments.
2025-08-14 11:47:09,717 INFO __main__ Processing data for Shipped_Items_Data tab...
2025-08-14 11:47:09,718 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Items_Data tab...
2025-08-14 11:47:09,728 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 675 rows.
2025-08-14 11:47:09,728 INFO __main__ Processing data for Shipped_Orders_Data tab...
2025-08-14 11:47:09,728 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Orders_Data tab...
2025-08-14 11:47:09,737 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 623 unique order rows.
2025-08-14 11:47:09,737 INFO __main__ Overwriting 'Shipped_Items_Data' tab with 675 rows...
2025-08-14 11:47:09,996 INFO src.services.gcp.secret_manager Successfully accessed secret 'google-sheets-service-account-key'.
2025-08-14 11:47:09,998 INFO src.services.google_sheets.api_client {'message': 'Google Sheets credentials successfully retrieved and cached.'}
2025-08-14 11:47:10,003 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 11:47:10,411 ERROR src.services.google_sheets.api_client {'message': 'An unexpected error occurred while writing data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'error': "('invalid_grant: Invalid JWT Signature.', {'error': 'invalid_grant', 'error_description': 'Invalid JWT Signature.'})", 'function': 'write_dataframe_to_sheet'}
Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\services\google_sheets\api_client.py", line 141, in write_dataframe_to_sheet
    ).execute()
      ^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\_helpers.py", line 130, in positional_wrapper
    return wrapped(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\http.py", line 923, in execute
    resp, content = _retry_request(
                    ^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\http.py", line 191, in _retry_request
    resp, content = http.request(uri, method, *args, **kwargs)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google_auth_httplib2.py", line 209, in request
    self.credentials.before_request(self._request, method, uri, request_headers)
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\auth\credentials.py", line 239, in before_request
    self._blocking_refresh(request)
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\auth\credentials.py", line 202, in _blocking_refresh
    self.refresh(request)
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\oauth2\service_account.py", line 448, in refresh
    access_token, expiry, _ = _client.jwt_grant(
                              ^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\oauth2\_client.py", line 299, in jwt_grant
    response_data = _token_endpoint_request(
                    ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\oauth2\_client.py", line 270, in _token_endpoint_request
    _handle_error_response(response_data, retryable_error)
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\oauth2\_client.py", line 69, in _handle_error_response
    raise exceptions.RefreshError(
google.auth.exceptions.RefreshError: ('invalid_grant: Invalid JWT Signature.', {'error': 'invalid_grant', 'error_description': 'Invalid JWT Signature.'})
2025-08-14 11:47:10,417 INFO __main__ Overwriting 'Shipped_Orders_Data' tab with 623 rows...
2025-08-14 11:47:10,420 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 11:47:10,816 ERROR src.services.google_sheets.api_client {'message': 'An unexpected error occurred while writing data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'error': "('invalid_grant: Invalid JWT Signature.', {'error': 'invalid_grant', 'error_description': 'Invalid JWT Signature.'})", 'function': 'write_dataframe_to_sheet'}
Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\services\google_sheets\api_client.py", line 141, in write_dataframe_to_sheet
    ).execute()
      ^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\_helpers.py", line 130, in positional_wrapper
    return wrapped(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\http.py", line 923, in execute
    resp, content = _retry_request(
                    ^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\http.py", line 191, in _retry_request
    resp, content = http.request(uri, method, *args, **kwargs)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google_auth_httplib2.py", line 209, in request
    self.credentials.before_request(self._request, method, uri, request_headers)
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\auth\credentials.py", line 239, in before_request
    self._blocking_refresh(request)
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\auth\credentials.py", line 202, in _blocking_refresh
    self.refresh(request)
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\oauth2\service_account.py", line 448, in refresh
    access_token, expiry, _ = _client.jwt_grant(
                              ^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\oauth2\_client.py", line 299, in jwt_grant
    response_data = _token_endpoint_request(
                    ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\oauth2\_client.py", line 270, in _token_endpoint_request
    _handle_error_response(response_data, retryable_error)
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\oauth2\_client.py", line 69, in _handle_error_response
    raise exceptions.RefreshError(
google.auth.exceptions.RefreshError: ('invalid_grant: Invalid JWT Signature.', {'error': 'invalid_grant', 'error_description': 'Invalid JWT Signature.'})
2025-08-14 11:47:10,819 INFO __main__ Fetching existing 52-week history for update...
2025-08-14 11:47:10,822 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 11:47:11,198 ERROR src.services.google_sheets.api_client {'message': 'An unexpected error occurred while retrieving data from Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'error': "('invalid_grant: Invalid JWT Signature.', {'error': 'invalid_grant', 'error_description': 'Invalid JWT Signature.'})", 'function': 'get_google_sheet_data'}
Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\services\google_sheets\api_client.py", line 79, in get_google_sheet_data
    spreadsheetId=sheet_id, range=range_name).execute()
                                              ^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\_helpers.py", line 130, in positional_wrapper
    return wrapped(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\http.py", line 923, in execute
    resp, content = _retry_request(
                    ^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\http.py", line 191, in _retry_request
    resp, content = http.request(uri, method, *args, **kwargs)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google_auth_httplib2.py", line 209, in request
    self.credentials.before_request(self._request, method, uri, request_headers)
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\auth\credentials.py", line 239, in before_request
    self._blocking_refresh(request)
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\auth\credentials.py", line 202, in _blocking_refresh
    self.refresh(request)
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\oauth2\service_account.py", line 448, in refresh
    access_token, expiry, _ = _client.jwt_grant(
                              ^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\oauth2\_client.py", line 299, in jwt_grant
    response_data = _token_endpoint_request(
                    ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\oauth2\_client.py", line 270, in _token_endpoint_request
    _handle_error_response(response_data, retryable_error)
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\oauth2\_client.py", line 69, in _handle_error_response
    raise exceptions.RefreshError(
google.auth.exceptions.RefreshError: ('invalid_grant: Invalid JWT Signature.', {'error': 'invalid_grant', 'error_description': 'Invalid JWT Signature.'})
2025-08-14 11:47:11,199 WARNING __main__ Could not read existing weekly history from 'ORA_Weekly_Shipped_History'. Skipping update.
2025-08-14 11:47:11,199 INFO __main__ --- Daily Shipment Processor finished successfully! ---
2025-08-14 11:52:09,327 INFO settings SERVICE_ACCOUNT_KEY_PATH is set to: C:\Users\NathanNeely\Projects\config\ora-automation-project-dev-25acb5551197.json
2025-08-14 11:52:09,327 INFO settings File exists: True
2025-08-14 11:52:09,327 INFO settings First 100 chars of key file: {
  "type": "service_account",
  "project_id": "ora-automation-project-dev",
  "private_key_id": "25
2025-08-14 11:57:15,950 INFO settings SERVICE_ACCOUNT_KEY_PATH is set to: C:\Users\NathanNeely\Projects\config\ora-automation-project-dev-25acb5551197.json
2025-08-14 11:57:15,951 INFO settings File exists: True
2025-08-14 11:57:15,951 INFO settings First 100 chars of key file: {
  "type": "service_account",
  "project_id": "ora-automation-project-dev",
  "private_key_id": "64
2025-08-14 11:58:13,522 INFO settings SERVICE_ACCOUNT_KEY_PATH is set to: C:\Users\NathanNeely\Projects\config\ora-automation-project-dev-25acb5551197.json
2025-08-14 11:58:13,522 INFO settings File exists: True
2025-08-14 11:58:13,522 INFO settings First 100 chars of key file: {
  "type": "service_account",
  "project_id": "ora-automation-project-dev",
  "private_key_id": "64
2025-08-14 11:58:36,625 INFO settings SERVICE_ACCOUNT_KEY_PATH is set to: C:\Users\NathanNeely\Projects\config\ora-automation-project-dev-25acb5551197.json
2025-08-14 11:58:36,626 INFO settings File exists: True
2025-08-14 11:58:36,626 INFO settings First 100 chars of key file: {
  "type": "service_account",
  "project_id": "ora-automation-project-dev",
  "private_key_id": "64
2025-08-14 11:59:31,718 INFO settings SERVICE_ACCOUNT_KEY_PATH is set to: C:\Users\NathanNeely\Projects\config\ora-automation-project-dev-25acb5551197.json
2025-08-14 11:59:31,719 INFO settings File exists: True
2025-08-14 11:59:31,719 INFO settings First 100 chars of key file: {
  "type": "service_account",
  "project_id": "ora-automation-project-dev",
  "private_key_id": "64
2025-08-14 11:59:32,091 INFO __main__ --- Starting Daily Shipment Processor ---
2025-08-14 11:59:32,091 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Key from Secret Manager...
2025-08-14 11:59:32,450 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-key'.
2025-08-14 11:59:32,450 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Secret from Secret Manager...
2025-08-14 11:59:32,751 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-secret'.
2025-08-14 11:59:32,751 INFO __main__ Using rolling 32-day date range: 2025-07-13 to 2025-08-14
2025-08-14 11:59:32,751 INFO src.services.shipstation.api_client Starting raw shipment fetch from 2025-07-13 with includeShipmentItems=true and status='shipped'...
2025-08-14 11:59:32,752 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 11:59:33,420 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 11:59:33,427 INFO src.services.shipstation.api_client Fetched page 1 of 2. Total shipments so far: 500
2025-08-14 11:59:33,428 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 11:59:33,937 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 11:59:33,939 INFO src.services.shipstation.api_client Fetched page 2 of 2. Total shipments so far: 676
2025-08-14 11:59:33,939 INFO src.services.shipstation.api_client Finished fetching ShipStation shipments. Total retrieved: 676
2025-08-14 11:59:33,941 INFO __main__ Processing 675 non-voided shipments.
2025-08-14 11:59:33,941 INFO __main__ Processing data for Shipped_Items_Data tab...
2025-08-14 11:59:33,941 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Items_Data tab...
2025-08-14 11:59:33,962 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 675 rows.
2025-08-14 11:59:33,963 INFO __main__ Processing data for Shipped_Orders_Data tab...
2025-08-14 11:59:33,963 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Orders_Data tab...
2025-08-14 11:59:33,971 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 623 unique order rows.
2025-08-14 11:59:33,971 INFO __main__ Overwriting 'Shipped_Items_Data' tab with 675 rows...
2025-08-14 11:59:34,464 INFO src.services.gcp.secret_manager Successfully accessed secret 'google-sheets-service-account-key'.
2025-08-14 11:59:34,465 INFO src.services.google_sheets.api_client {'message': 'Google Sheets credentials successfully retrieved and cached.'}
2025-08-14 11:59:34,471 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 11:59:34,920 ERROR src.services.google_sheets.api_client {'message': 'An unexpected error occurred while writing data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'error': "('invalid_grant: Invalid JWT Signature.', {'error': 'invalid_grant', 'error_description': 'Invalid JWT Signature.'})", 'function': 'write_dataframe_to_sheet'}
Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\services\google_sheets\api_client.py", line 141, in write_dataframe_to_sheet
    ).execute()
      ^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\_helpers.py", line 130, in positional_wrapper
    return wrapped(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\http.py", line 923, in execute
    resp, content = _retry_request(
                    ^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\http.py", line 191, in _retry_request
    resp, content = http.request(uri, method, *args, **kwargs)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google_auth_httplib2.py", line 209, in request
    self.credentials.before_request(self._request, method, uri, request_headers)
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\auth\credentials.py", line 239, in before_request
    self._blocking_refresh(request)
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\auth\credentials.py", line 202, in _blocking_refresh
    self.refresh(request)
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\oauth2\service_account.py", line 448, in refresh
    access_token, expiry, _ = _client.jwt_grant(
                              ^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\oauth2\_client.py", line 299, in jwt_grant
    response_data = _token_endpoint_request(
                    ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\oauth2\_client.py", line 270, in _token_endpoint_request
    _handle_error_response(response_data, retryable_error)
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\oauth2\_client.py", line 69, in _handle_error_response
    raise exceptions.RefreshError(
google.auth.exceptions.RefreshError: ('invalid_grant: Invalid JWT Signature.', {'error': 'invalid_grant', 'error_description': 'Invalid JWT Signature.'})
2025-08-14 11:59:34,924 INFO __main__ Overwriting 'Shipped_Orders_Data' tab with 623 rows...
2025-08-14 11:59:34,926 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 11:59:35,411 ERROR src.services.google_sheets.api_client {'message': 'An unexpected error occurred while writing data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'error': "('invalid_grant: Invalid JWT Signature.', {'error': 'invalid_grant', 'error_description': 'Invalid JWT Signature.'})", 'function': 'write_dataframe_to_sheet'}
Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\services\google_sheets\api_client.py", line 141, in write_dataframe_to_sheet
    ).execute()
      ^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\_helpers.py", line 130, in positional_wrapper
    return wrapped(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\http.py", line 923, in execute
    resp, content = _retry_request(
                    ^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\http.py", line 191, in _retry_request
    resp, content = http.request(uri, method, *args, **kwargs)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google_auth_httplib2.py", line 209, in request
    self.credentials.before_request(self._request, method, uri, request_headers)
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\auth\credentials.py", line 239, in before_request
    self._blocking_refresh(request)
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\auth\credentials.py", line 202, in _blocking_refresh
    self.refresh(request)
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\oauth2\service_account.py", line 448, in refresh
    access_token, expiry, _ = _client.jwt_grant(
                              ^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\oauth2\_client.py", line 299, in jwt_grant
    response_data = _token_endpoint_request(
                    ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\oauth2\_client.py", line 270, in _token_endpoint_request
    _handle_error_response(response_data, retryable_error)
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\oauth2\_client.py", line 69, in _handle_error_response
    raise exceptions.RefreshError(
google.auth.exceptions.RefreshError: ('invalid_grant: Invalid JWT Signature.', {'error': 'invalid_grant', 'error_description': 'Invalid JWT Signature.'})
2025-08-14 11:59:35,413 INFO __main__ Fetching existing 52-week history for update...
2025-08-14 11:59:35,415 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 11:59:35,811 ERROR src.services.google_sheets.api_client {'message': 'An unexpected error occurred while retrieving data from Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'error': "('invalid_grant: Invalid JWT Signature.', {'error': 'invalid_grant', 'error_description': 'Invalid JWT Signature.'})", 'function': 'get_google_sheet_data'}
Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\services\google_sheets\api_client.py", line 79, in get_google_sheet_data
    spreadsheetId=sheet_id, range=range_name).execute()
                                              ^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\_helpers.py", line 130, in positional_wrapper
    return wrapped(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\http.py", line 923, in execute
    resp, content = _retry_request(
                    ^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\http.py", line 191, in _retry_request
    resp, content = http.request(uri, method, *args, **kwargs)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google_auth_httplib2.py", line 209, in request
    self.credentials.before_request(self._request, method, uri, request_headers)
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\auth\credentials.py", line 239, in before_request
    self._blocking_refresh(request)
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\auth\credentials.py", line 202, in _blocking_refresh
    self.refresh(request)
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\oauth2\service_account.py", line 448, in refresh
    access_token, expiry, _ = _client.jwt_grant(
                              ^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\oauth2\_client.py", line 299, in jwt_grant
    response_data = _token_endpoint_request(
                    ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\oauth2\_client.py", line 270, in _token_endpoint_request
    _handle_error_response(response_data, retryable_error)
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\google\oauth2\_client.py", line 69, in _handle_error_response
    raise exceptions.RefreshError(
google.auth.exceptions.RefreshError: ('invalid_grant: Invalid JWT Signature.', {'error': 'invalid_grant', 'error_description': 'Invalid JWT Signature.'})
2025-08-14 11:59:35,812 WARNING __main__ Could not read existing weekly history from 'ORA_Weekly_Shipped_History'. Skipping update.
2025-08-14 11:59:35,813 INFO __main__ --- Daily Shipment Processor finished successfully! ---
2025-08-14 12:23:24,998 INFO settings SERVICE_ACCOUNT_KEY_PATH is set to: C:\Users\NathanNeely\Projects\config\ora-automation-project-dev-25acb5551197.json
2025-08-14 12:23:24,998 INFO settings File exists: True
2025-08-14 12:23:24,999 INFO settings First 100 chars of key file: {
  "type": "service_account",
  "project_id": "ora-automation-project-dev",
  "private_key_id": "64
2025-08-14 12:23:25,472 INFO __main__ --- Starting Daily Shipment Processor ---
2025-08-14 12:23:25,472 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Key from Secret Manager...
2025-08-14 12:23:25,825 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-key'.
2025-08-14 12:23:25,825 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Secret from Secret Manager...
2025-08-14 12:23:26,090 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-secret'.
2025-08-14 12:23:26,092 INFO __main__ Using rolling 32-day date range: 2025-07-13 to 2025-08-14
2025-08-14 12:23:26,092 INFO src.services.shipstation.api_client Starting raw shipment fetch from 2025-07-13 with includeShipmentItems=true and status='shipped'...
2025-08-14 12:23:26,093 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 12:23:26,815 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 12:23:26,822 INFO src.services.shipstation.api_client Fetched page 1 of 2. Total shipments so far: 500
2025-08-14 12:23:26,823 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 12:23:27,339 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 12:23:27,347 INFO src.services.shipstation.api_client Fetched page 2 of 2. Total shipments so far: 676
2025-08-14 12:23:27,348 INFO src.services.shipstation.api_client Finished fetching ShipStation shipments. Total retrieved: 676
2025-08-14 12:23:27,349 INFO __main__ Processing 675 non-voided shipments.
2025-08-14 12:23:27,349 INFO __main__ Processing data for Shipped_Items_Data tab...
2025-08-14 12:23:27,349 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Items_Data tab...
2025-08-14 12:23:27,367 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 675 rows.
2025-08-14 12:23:27,367 INFO __main__ Processing data for Shipped_Orders_Data tab...
2025-08-14 12:23:27,367 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Orders_Data tab...
2025-08-14 12:23:27,378 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 623 unique order rows.
2025-08-14 12:23:27,378 INFO __main__ Overwriting 'Shipped_Items_Data' tab with 675 rows...
2025-08-14 12:23:27,677 INFO src.services.gcp.secret_manager Successfully accessed secret 'google-sheets-service-account-key'.
2025-08-14 12:23:27,678 INFO src.services.google_sheets.api_client {'message': 'Google Sheets credentials successfully retrieved and cached.'}
2025-08-14 12:23:27,682 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 12:23:28,671 ERROR src.services.google_sheets.api_client {'message': 'An unexpected error occurred while writing data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'error': 'Object of type date is not JSON serializable', 'function': 'write_dataframe_to_sheet'}
Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\services\google_sheets\api_client.py", line 145, in write_dataframe_to_sheet
    result = service.spreadsheets().values().update(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\discovery.py", line 1176, in method
    headers, params, query, body = model.request(
                                   ^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\model.py", line 180, in request
    body_value = self.serialize(body_value)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\model.py", line 293, in serialize
    return json.dumps(body_value)
           ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\encoder.py", line 258, in iterencode
    return _iterencode(o, 0)
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\encoder.py", line 180, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type date is not JSON serializable
2025-08-14 12:23:28,718 INFO __main__ Overwriting 'Shipped_Orders_Data' tab with 623 rows...
2025-08-14 12:23:28,719 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 12:23:29,676 ERROR src.services.google_sheets.api_client {'message': 'An unexpected error occurred while writing data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'error': 'Object of type date is not JSON serializable', 'function': 'write_dataframe_to_sheet'}
Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\services\google_sheets\api_client.py", line 145, in write_dataframe_to_sheet
    result = service.spreadsheets().values().update(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\discovery.py", line 1176, in method
    headers, params, query, body = model.request(
                                   ^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\model.py", line 180, in request
    body_value = self.serialize(body_value)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\model.py", line 293, in serialize
    return json.dumps(body_value)
           ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\encoder.py", line 258, in iterencode
    return _iterencode(o, 0)
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\encoder.py", line 180, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type date is not JSON serializable
2025-08-14 12:23:29,678 INFO __main__ Fetching existing 52-week history for update...
2025-08-14 12:23:29,679 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 12:23:30,089 INFO src.services.google_sheets.api_client {'message': 'Successfully retrieved data from Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_count': 52}
2025-08-14 12:23:30,090 CRITICAL __main__ An unhandled error occurred in the daily shipment processor: 'list' object has no attribute 'empty'
Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\daily_shipment_processor.py", line 185, in run_daily_shipment_pull
    if existing_history_df is not None and not existing_history_df.empty:
                                               ^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'list' object has no attribute 'empty'
2025-08-14 12:24:53,410 INFO settings SERVICE_ACCOUNT_KEY_PATH is set to: C:\Users\NathanNeely\Projects\config\ora-automation-project-dev-25acb5551197.json
2025-08-14 12:24:53,411 INFO settings File exists: True
2025-08-14 12:24:53,411 INFO settings First 100 chars of key file: {
  "type": "service_account",
  "project_id": "ora-automation-project-dev",
  "private_key_id": "64
2025-08-14 12:24:53,847 INFO __main__ --- Starting Daily Shipment Processor ---
2025-08-14 12:24:53,848 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Key from Secret Manager...
2025-08-14 12:24:54,126 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-key'.
2025-08-14 12:24:54,126 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Secret from Secret Manager...
2025-08-14 12:24:54,401 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-secret'.
2025-08-14 12:24:54,402 INFO __main__ Using rolling 32-day date range: 2025-07-13 to 2025-08-14
2025-08-14 12:24:54,403 INFO src.services.shipstation.api_client Starting raw shipment fetch from 2025-07-13 with includeShipmentItems=true and status='shipped'...
2025-08-14 12:24:54,403 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 12:24:55,148 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 12:24:55,156 INFO src.services.shipstation.api_client Fetched page 1 of 2. Total shipments so far: 500
2025-08-14 12:24:55,157 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 12:24:55,650 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 12:24:55,652 INFO src.services.shipstation.api_client Fetched page 2 of 2. Total shipments so far: 705
2025-08-14 12:24:55,653 INFO src.services.shipstation.api_client Finished fetching ShipStation shipments. Total retrieved: 705
2025-08-14 12:24:55,653 INFO __main__ Processing 704 non-voided shipments.
2025-08-14 12:24:55,654 INFO __main__ Processing data for Shipped_Items_Data tab...
2025-08-14 12:24:55,654 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Items_Data tab...
2025-08-14 12:24:55,660 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 704 rows.
2025-08-14 12:24:55,660 INFO __main__ Processing data for Shipped_Orders_Data tab...
2025-08-14 12:24:55,660 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Orders_Data tab...
2025-08-14 12:24:55,665 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 649 unique order rows.
2025-08-14 12:24:55,667 INFO __main__ Overwriting 'Shipped_Items_Data' tab with 704 rows...
2025-08-14 12:24:56,006 INFO src.services.gcp.secret_manager Successfully accessed secret 'google-sheets-service-account-key'.
2025-08-14 12:24:56,009 INFO src.services.google_sheets.api_client {'message': 'Google Sheets credentials successfully retrieved and cached.'}
2025-08-14 12:24:56,012 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 12:24:56,923 ERROR src.services.google_sheets.api_client {'message': 'An unexpected error occurred while writing data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'error': 'Object of type date is not JSON serializable', 'function': 'write_dataframe_to_sheet'}
Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\services\google_sheets\api_client.py", line 145, in write_dataframe_to_sheet
    result = service.spreadsheets().values().update(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\discovery.py", line 1176, in method
    headers, params, query, body = model.request(
                                   ^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\model.py", line 180, in request
    body_value = self.serialize(body_value)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\model.py", line 293, in serialize
    return json.dumps(body_value)
           ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\encoder.py", line 258, in iterencode
    return _iterencode(o, 0)
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\encoder.py", line 180, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type date is not JSON serializable
2025-08-14 12:24:56,925 INFO __main__ Overwriting 'Shipped_Orders_Data' tab with 649 rows...
2025-08-14 12:24:56,927 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 12:24:57,420 ERROR src.services.google_sheets.api_client {'message': 'An unexpected error occurred while writing data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'error': 'Object of type date is not JSON serializable', 'function': 'write_dataframe_to_sheet'}
Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\services\google_sheets\api_client.py", line 145, in write_dataframe_to_sheet
    result = service.spreadsheets().values().update(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\discovery.py", line 1176, in method
    headers, params, query, body = model.request(
                                   ^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\model.py", line 180, in request
    body_value = self.serialize(body_value)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\model.py", line 293, in serialize
    return json.dumps(body_value)
           ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\encoder.py", line 258, in iterencode
    return _iterencode(o, 0)
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\encoder.py", line 180, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type date is not JSON serializable
2025-08-14 12:24:57,422 INFO __main__ Fetching existing 52-week history for update...
2025-08-14 12:24:57,424 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 12:24:57,810 INFO src.services.google_sheets.api_client {'message': 'Successfully retrieved data from Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_count': 52}
2025-08-14 12:24:57,810 CRITICAL __main__ An unhandled error occurred in the daily shipment processor: 'list' object has no attribute 'empty'
Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\daily_shipment_processor.py", line 185, in run_daily_shipment_pull
    if existing_history_df is not None and not existing_history_df.empty:
                                               ^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'list' object has no attribute 'empty'
2025-08-14 13:20:29,053 INFO settings SERVICE_ACCOUNT_KEY_PATH is set to: C:\Users\NathanNeely\Projects\config\ora-automation-project-dev-25acb5551197.json
2025-08-14 13:20:29,054 INFO settings File exists: True
2025-08-14 13:20:29,054 INFO settings First 100 chars of key file: {
  "type": "service_account",
  "project_id": "ora-automation-project-dev",
  "private_key_id": "64
2025-08-14 13:20:29,673 INFO __main__ --- Starting Daily Shipment Processor ---
2025-08-14 13:20:29,674 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Key from Secret Manager...
2025-08-14 13:20:30,065 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-key'.
2025-08-14 13:20:30,065 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Secret from Secret Manager...
2025-08-14 13:20:30,380 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-secret'.
2025-08-14 13:20:30,380 INFO __main__ Using rolling 32-day date range: 2025-07-13 to 2025-08-14
2025-08-14 13:20:30,381 INFO src.services.shipstation.api_client Starting raw shipment fetch from 2025-07-13 with includeShipmentItems=true and status='shipped'...
2025-08-14 13:20:30,381 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 13:20:31,111 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 13:20:31,119 INFO src.services.shipstation.api_client Fetched page 1 of 2. Total shipments so far: 500
2025-08-14 13:20:31,120 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 13:20:31,613 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 13:20:31,616 INFO src.services.shipstation.api_client Fetched page 2 of 2. Total shipments so far: 705
2025-08-14 13:20:31,616 INFO src.services.shipstation.api_client Finished fetching ShipStation shipments. Total retrieved: 705
2025-08-14 13:20:31,616 INFO __main__ Processing 704 non-voided shipments.
2025-08-14 13:20:31,617 INFO __main__ Processing data for Shipped_Items_Data tab...
2025-08-14 13:20:31,617 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Items_Data tab...
2025-08-14 13:20:31,630 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 704 rows.
2025-08-14 13:20:31,630 INFO __main__ Processing data for Shipped_Orders_Data tab...
2025-08-14 13:20:31,631 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Orders_Data tab...
2025-08-14 13:20:31,640 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 649 unique order rows.
2025-08-14 13:20:31,640 INFO __main__ Overwriting 'Shipped_Items_Data' tab with 704 rows...
2025-08-14 13:20:32,084 INFO src.services.gcp.secret_manager Successfully accessed secret 'google-sheets-service-account-key'.
2025-08-14 13:20:32,085 INFO src.services.google_sheets.api_client {'message': 'Google Sheets credentials successfully retrieved and cached.'}
2025-08-14 13:20:32,089 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:20:33,091 ERROR src.services.google_sheets.api_client {'message': 'An unexpected error occurred while writing data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'error': 'Object of type date is not JSON serializable', 'function': 'write_dataframe_to_sheet'}
Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\services\google_sheets\api_client.py", line 156, in write_dataframe_to_sheet
    result = service.spreadsheets().values().update(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\discovery.py", line 1176, in method
    headers, params, query, body = model.request(
                                   ^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\model.py", line 180, in request
    body_value = self.serialize(body_value)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\model.py", line 293, in serialize
    return json.dumps(body_value)
           ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\encoder.py", line 258, in iterencode
    return _iterencode(o, 0)
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\encoder.py", line 180, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type date is not JSON serializable
2025-08-14 13:20:33,096 INFO __main__ Overwriting 'Shipped_Orders_Data' tab with 649 rows...
2025-08-14 13:20:33,099 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:20:34,091 ERROR src.services.google_sheets.api_client {'message': 'An unexpected error occurred while writing data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'error': 'Object of type date is not JSON serializable', 'function': 'write_dataframe_to_sheet'}
Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\services\google_sheets\api_client.py", line 156, in write_dataframe_to_sheet
    result = service.spreadsheets().values().update(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\discovery.py", line 1176, in method
    headers, params, query, body = model.request(
                                   ^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\model.py", line 180, in request
    body_value = self.serialize(body_value)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\model.py", line 293, in serialize
    return json.dumps(body_value)
           ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\encoder.py", line 258, in iterencode
    return _iterencode(o, 0)
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\encoder.py", line 180, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type date is not JSON serializable
2025-08-14 13:20:34,092 INFO __main__ Fetching existing 52-week history for update...
2025-08-14 13:20:34,095 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:20:34,508 INFO src.services.google_sheets.api_client {'message': 'Successfully retrieved data from Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_count': 52}
2025-08-14 13:20:34,509 CRITICAL __main__ An unhandled error occurred in the daily shipment processor: 'list' object has no attribute 'empty'
Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\daily_shipment_processor.py", line 185, in run_daily_shipment_pull
    if existing_history_df is not None and not existing_history_df.empty:
                                               ^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'list' object has no attribute 'empty'
2025-08-14 13:22:25,861 INFO settings SERVICE_ACCOUNT_KEY_PATH is set to: C:\Users\NathanNeely\Projects\config\ora-automation-project-dev-25acb5551197.json
2025-08-14 13:22:25,862 INFO settings File exists: True
2025-08-14 13:22:25,862 INFO settings First 100 chars of key file: {
  "type": "service_account",
  "project_id": "ora-automation-project-dev",
  "private_key_id": "64
2025-08-14 13:22:26,215 INFO __main__ --- Starting Daily Shipment Processor ---
2025-08-14 13:22:26,216 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Key from Secret Manager...
2025-08-14 13:22:26,466 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-key'.
2025-08-14 13:22:26,466 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Secret from Secret Manager...
2025-08-14 13:22:26,726 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-secret'.
2025-08-14 13:22:26,727 INFO __main__ Using rolling 32-day date range: 2025-07-13 to 2025-08-14
2025-08-14 13:22:26,728 INFO src.services.shipstation.api_client Starting raw shipment fetch from 2025-07-13 with includeShipmentItems=true and status='shipped'...
2025-08-14 13:22:26,729 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 13:22:27,383 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 13:22:27,389 INFO src.services.shipstation.api_client Fetched page 1 of 2. Total shipments so far: 500
2025-08-14 13:22:27,390 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 13:22:27,918 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 13:22:27,921 INFO src.services.shipstation.api_client Fetched page 2 of 2. Total shipments so far: 705
2025-08-14 13:22:27,921 INFO src.services.shipstation.api_client Finished fetching ShipStation shipments. Total retrieved: 705
2025-08-14 13:22:27,922 INFO __main__ Processing 704 non-voided shipments.
2025-08-14 13:22:27,922 INFO __main__ Processing data for Shipped_Items_Data tab...
2025-08-14 13:22:27,922 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Items_Data tab...
2025-08-14 13:22:27,928 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 704 rows.
2025-08-14 13:22:27,928 INFO __main__ Processing data for Shipped_Orders_Data tab...
2025-08-14 13:22:27,928 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Orders_Data tab...
2025-08-14 13:22:27,934 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 649 unique order rows.
2025-08-14 13:22:27,934 INFO __main__ Overwriting 'Shipped_Items_Data' tab with 704 rows...
2025-08-14 13:22:28,348 INFO src.services.gcp.secret_manager Successfully accessed secret 'google-sheets-service-account-key'.
2025-08-14 13:22:28,349 INFO src.services.google_sheets.api_client {'message': 'Google Sheets credentials successfully retrieved and cached.'}
2025-08-14 13:22:28,351 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:22:29,149 ERROR src.services.google_sheets.api_client {'message': 'An unexpected error occurred while writing data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'error': 'Object of type date is not JSON serializable', 'function': 'write_dataframe_to_sheet'}
Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\services\google_sheets\api_client.py", line 156, in write_dataframe_to_sheet
    result = service.spreadsheets().values().update(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\discovery.py", line 1176, in method
    headers, params, query, body = model.request(
                                   ^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\model.py", line 180, in request
    body_value = self.serialize(body_value)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\model.py", line 293, in serialize
    return json.dumps(body_value)
           ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\encoder.py", line 258, in iterencode
    return _iterencode(o, 0)
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\encoder.py", line 180, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type date is not JSON serializable
2025-08-14 13:22:29,151 INFO __main__ Overwriting 'Shipped_Orders_Data' tab with 649 rows...
2025-08-14 13:22:29,154 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:22:29,633 ERROR src.services.google_sheets.api_client {'message': 'An unexpected error occurred while writing data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'error': 'Object of type date is not JSON serializable', 'function': 'write_dataframe_to_sheet'}
Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\services\google_sheets\api_client.py", line 156, in write_dataframe_to_sheet
    result = service.spreadsheets().values().update(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\discovery.py", line 1176, in method
    headers, params, query, body = model.request(
                                   ^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\model.py", line 180, in request
    body_value = self.serialize(body_value)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\model.py", line 293, in serialize
    return json.dumps(body_value)
           ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\encoder.py", line 258, in iterencode
    return _iterencode(o, 0)
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\encoder.py", line 180, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type date is not JSON serializable
2025-08-14 13:22:29,633 INFO __main__ Fetching existing 52-week history for update...
2025-08-14 13:22:29,634 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:22:30,077 INFO src.services.google_sheets.api_client {'message': 'Successfully retrieved data from Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_count': 52}
2025-08-14 13:22:30,078 CRITICAL __main__ An unhandled error occurred in the daily shipment processor: 'list' object has no attribute 'empty'
Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\daily_shipment_processor.py", line 185, in run_daily_shipment_pull
    if existing_history_df is not None and not existing_history_df.empty:
                                               ^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'list' object has no attribute 'empty'
2025-08-14 13:25:28,449 INFO settings SERVICE_ACCOUNT_KEY_PATH is set to: C:\Users\NathanNeely\Projects\config\ora-automation-project-dev-25acb5551197.json
2025-08-14 13:25:28,450 INFO settings File exists: True
2025-08-14 13:25:28,450 INFO settings First 100 chars of key file: {
  "type": "service_account",
  "project_id": "ora-automation-project-dev",
  "private_key_id": "64
2025-08-14 13:25:28,881 INFO __main__ --- Starting Daily Shipment Processor ---
2025-08-14 13:25:28,883 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Key from Secret Manager...
2025-08-14 13:25:29,309 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-key'.
2025-08-14 13:25:29,310 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Secret from Secret Manager...
2025-08-14 13:25:29,668 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-secret'.
2025-08-14 13:25:29,668 INFO __main__ Using rolling 32-day date range: 2025-07-13 to 2025-08-14
2025-08-14 13:25:29,669 INFO src.services.shipstation.api_client Starting raw shipment fetch from 2025-07-13 with includeShipmentItems=true and status='shipped'...
2025-08-14 13:25:29,669 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 13:25:30,489 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 13:25:30,496 INFO src.services.shipstation.api_client Fetched page 1 of 2. Total shipments so far: 500
2025-08-14 13:25:30,497 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 13:25:31,172 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 13:25:31,175 INFO src.services.shipstation.api_client Fetched page 2 of 2. Total shipments so far: 705
2025-08-14 13:25:31,175 INFO src.services.shipstation.api_client Finished fetching ShipStation shipments. Total retrieved: 705
2025-08-14 13:25:31,175 INFO __main__ Processing 704 non-voided shipments.
2025-08-14 13:25:31,176 INFO __main__ Processing data for Shipped_Items_Data tab...
2025-08-14 13:25:31,176 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Items_Data tab...
2025-08-14 13:25:31,183 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 704 rows.
2025-08-14 13:25:31,183 INFO __main__ Processing data for Shipped_Orders_Data tab...
2025-08-14 13:25:31,184 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Orders_Data tab...
2025-08-14 13:25:31,190 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 649 unique order rows.
2025-08-14 13:25:31,191 INFO __main__ Overwriting 'Shipped_Items_Data' tab with 704 rows...
2025-08-14 13:25:31,191 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'SKU - Lot': 'object', 'Quantity Shipped': 'int64', 'Base SKU': 'object'}}
2025-08-14 13:25:31,194 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'SKU - Lot': ['17612 - 250195', '17612 - 250195', '17612 - 250195'], 'Quantity Shipped': [6, 2, 6], 'Base SKU': ['17612', '17612', '17612']}}
2025-08-14 13:25:31,195 DEBUG src.services.google_sheets.api_client {'message': 'Attempting to retrieve Google Sheets service account key from Secret Manager.'}
2025-08-14 13:25:31,689 INFO src.services.gcp.secret_manager Successfully accessed secret 'google-sheets-service-account-key'.
2025-08-14 13:25:31,690 INFO src.services.google_sheets.api_client {'message': 'Google Sheets credentials successfully retrieved and cached.'}
2025-08-14 13:25:31,695 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:25:31,697 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 13:25:32,741 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'rows_to_write': 705}
2025-08-14 13:25:32,769 ERROR src.services.google_sheets.api_client {'message': 'An unexpected error occurred while writing data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'error': 'Object of type date is not JSON serializable', 'function': 'write_dataframe_to_sheet'}
Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\services\google_sheets\api_client.py", line 159, in write_dataframe_to_sheet
    result = service.spreadsheets().values().update(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\discovery.py", line 1176, in method
    headers, params, query, body = model.request(
                                   ^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\model.py", line 180, in request
    body_value = self.serialize(body_value)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\model.py", line 293, in serialize
    return json.dumps(body_value)
           ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\encoder.py", line 258, in iterencode
    return _iterencode(o, 0)
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\encoder.py", line 180, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type date is not JSON serializable
2025-08-14 13:25:32,771 INFO __main__ Overwriting 'Shipped_Orders_Data' tab with 649 rows...
2025-08-14 13:25:32,772 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'OrderNumber': 'object'}}
2025-08-14 13:25:32,773 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'OrderNumber': ['669495', '669455', '669445']}}
2025-08-14 13:25:32,773 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 13:25:32,777 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:25:32,809 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 13:25:33,346 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'rows_to_write': 650}
2025-08-14 13:25:33,374 ERROR src.services.google_sheets.api_client {'message': 'An unexpected error occurred while writing data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'error': 'Object of type date is not JSON serializable', 'function': 'write_dataframe_to_sheet'}
Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\services\google_sheets\api_client.py", line 159, in write_dataframe_to_sheet
    result = service.spreadsheets().values().update(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\discovery.py", line 1176, in method
    headers, params, query, body = model.request(
                                   ^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\model.py", line 180, in request
    body_value = self.serialize(body_value)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\googleapiclient\model.py", line 293, in serialize
    return json.dumps(body_value)
           ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\encoder.py", line 258, in iterencode
    return _iterencode(o, 0)
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\AppData\Local\Programs\Python\Python311\Lib\json\encoder.py", line 180, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type date is not JSON serializable
2025-08-14 13:25:33,375 INFO __main__ Fetching existing 52-week history for update...
2025-08-14 13:25:33,375 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 13:25:33,377 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:25:33,380 DEBUG src.services.google_sheets.api_client {'message': 'Fetching data from Google Sheet', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'range': "'ORA_Weekly_Shipped_History'!A:ZZ"}
2025-08-14 13:25:33,761 INFO src.services.google_sheets.api_client {'message': 'Successfully retrieved data from Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_count': 52}
2025-08-14 13:25:33,761 CRITICAL __main__ An unhandled error occurred in the daily shipment processor: 'list' object has no attribute 'empty'
Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\daily_shipment_processor.py", line 185, in run_daily_shipment_pull
    if existing_history_df is not None and not existing_history_df.empty:
                                               ^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'list' object has no attribute 'empty'
2025-08-14 13:27:06,443 INFO settings SERVICE_ACCOUNT_KEY_PATH is set to: C:\Users\NathanNeely\Projects\config\ora-automation-project-dev-25acb5551197.json
2025-08-14 13:27:06,443 INFO settings File exists: True
2025-08-14 13:27:06,444 INFO settings First 100 chars of key file: {
  "type": "service_account",
  "project_id": "ora-automation-project-dev",
  "private_key_id": "64
2025-08-14 13:27:06,868 INFO __main__ --- Starting Daily Shipment Processor ---
2025-08-14 13:27:06,869 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Key from Secret Manager...
2025-08-14 13:27:07,289 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-key'.
2025-08-14 13:27:07,290 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Secret from Secret Manager...
2025-08-14 13:27:07,847 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-secret'.
2025-08-14 13:27:07,848 INFO __main__ Using rolling 32-day date range: 2025-07-13 to 2025-08-14
2025-08-14 13:27:07,848 INFO src.services.shipstation.api_client Starting raw shipment fetch from 2025-07-13 with includeShipmentItems=true and status='shipped'...
2025-08-14 13:27:07,848 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 13:27:08,776 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 13:27:08,786 INFO src.services.shipstation.api_client Fetched page 1 of 2. Total shipments so far: 500
2025-08-14 13:27:08,786 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 13:27:09,355 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 13:27:09,358 INFO src.services.shipstation.api_client Fetched page 2 of 2. Total shipments so far: 705
2025-08-14 13:27:09,359 INFO src.services.shipstation.api_client Finished fetching ShipStation shipments. Total retrieved: 705
2025-08-14 13:27:09,360 INFO __main__ Processing 704 non-voided shipments.
2025-08-14 13:27:09,360 INFO __main__ Processing data for Shipped_Items_Data tab...
2025-08-14 13:27:09,361 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Items_Data tab...
2025-08-14 13:27:09,370 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 704 rows.
2025-08-14 13:27:09,370 INFO __main__ Processing data for Shipped_Orders_Data tab...
2025-08-14 13:27:09,371 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Orders_Data tab...
2025-08-14 13:27:09,377 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 649 unique order rows.
2025-08-14 13:27:09,378 INFO __main__ Overwriting 'Shipped_Items_Data' tab with 704 rows...
2025-08-14 13:27:09,379 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'SKU - Lot': 'object', 'Quantity Shipped': 'int64', 'Base SKU': 'object'}}
2025-08-14 13:27:09,382 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'SKU - Lot': ['17612 - 250195', '17612 - 250195', '17612 - 250195'], 'Quantity Shipped': [6, 2, 6], 'Base SKU': ['17612', '17612', '17612']}}
2025-08-14 13:27:09,387 DEBUG src.services.google_sheets.api_client {'message': 'Attempting to retrieve Google Sheets service account key from Secret Manager.'}
2025-08-14 13:27:09,695 INFO src.services.gcp.secret_manager Successfully accessed secret 'google-sheets-service-account-key'.
2025-08-14 13:27:09,697 INFO src.services.google_sheets.api_client {'message': 'Google Sheets credentials successfully retrieved and cached.'}
2025-08-14 13:27:09,702 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:27:09,705 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 13:27:10,535 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'rows_to_write': 705}
2025-08-14 13:27:10,789 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'updated_cells': 2820}
2025-08-14 13:27:11,340 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 13:27:11,341 INFO __main__ Overwriting 'Shipped_Orders_Data' tab with 649 rows...
2025-08-14 13:27:11,341 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'OrderNumber': 'object'}}
2025-08-14 13:27:11,343 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'OrderNumber': ['669495', '669455', '669445']}}
2025-08-14 13:27:11,345 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 13:27:11,348 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:27:11,352 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 13:27:11,760 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'rows_to_write': 650}
2025-08-14 13:27:11,994 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'updated_cells': 1300}
2025-08-14 13:27:12,547 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 13:27:12,548 INFO __main__ Fetching existing 52-week history for update...
2025-08-14 13:27:12,549 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 13:27:12,553 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:27:12,564 DEBUG src.services.google_sheets.api_client {'message': 'Fetching data from Google Sheet', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'range': "'ORA_Weekly_Shipped_History'!A:ZZ"}
2025-08-14 13:27:13,247 INFO src.services.google_sheets.api_client {'message': 'Successfully retrieved data from Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_count': 52}
2025-08-14 13:27:13,247 CRITICAL __main__ An unhandled error occurred in the daily shipment processor: 'list' object has no attribute 'empty'
Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\daily_shipment_processor.py", line 185, in run_daily_shipment_pull
    if existing_history_df is not None and not existing_history_df.empty:
                                               ^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'list' object has no attribute 'empty'
2025-08-14 13:30:22,079 INFO settings SERVICE_ACCOUNT_KEY_PATH is set to: C:\Users\NathanNeely\Projects\config\ora-automation-project-dev-25acb5551197.json
2025-08-14 13:30:22,080 INFO settings File exists: True
2025-08-14 13:30:22,080 INFO settings First 100 chars of key file: {
  "type": "service_account",
  "project_id": "ora-automation-project-dev",
  "private_key_id": "64
2025-08-14 13:30:22,603 INFO __main__ --- Starting Daily Shipment Processor ---
2025-08-14 13:30:22,603 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Key from Secret Manager...
2025-08-14 13:30:22,909 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-key'.
2025-08-14 13:30:22,909 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Secret from Secret Manager...
2025-08-14 13:30:23,166 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-secret'.
2025-08-14 13:30:23,167 INFO __main__ Using rolling 32-day date range: 2025-07-13 to 2025-08-14
2025-08-14 13:30:23,167 INFO src.services.shipstation.api_client Starting raw shipment fetch from 2025-07-13 with includeShipmentItems=true and status='shipped'...
2025-08-14 13:30:23,168 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 13:30:23,818 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 13:30:23,825 INFO src.services.shipstation.api_client Fetched page 1 of 2. Total shipments so far: 500
2025-08-14 13:30:23,826 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 13:30:24,319 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 13:30:24,322 INFO src.services.shipstation.api_client Fetched page 2 of 2. Total shipments so far: 705
2025-08-14 13:30:24,323 INFO src.services.shipstation.api_client Finished fetching ShipStation shipments. Total retrieved: 705
2025-08-14 13:30:24,323 INFO __main__ Processing 704 non-voided shipments.
2025-08-14 13:30:24,323 INFO __main__ Processing data for Shipped_Items_Data tab...
2025-08-14 13:30:24,324 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Items_Data tab...
2025-08-14 13:30:24,334 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 704 rows.
2025-08-14 13:30:24,334 INFO __main__ Processing data for Shipped_Orders_Data tab...
2025-08-14 13:30:24,335 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Orders_Data tab...
2025-08-14 13:30:24,344 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 649 unique order rows.
2025-08-14 13:30:24,345 INFO __main__ Overwriting 'Shipped_Items_Data' tab with 704 rows...
2025-08-14 13:30:24,346 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'SKU - Lot': 'object', 'Quantity Shipped': 'int64', 'Base SKU': 'object'}}
2025-08-14 13:30:24,349 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'SKU - Lot': ['17612 - 250195', '17612 - 250195', '17612 - 250195'], 'Quantity Shipped': [6, 2, 6], 'Base SKU': ['17612', '17612', '17612']}}
2025-08-14 13:30:24,353 DEBUG src.services.google_sheets.api_client {'message': 'Attempting to retrieve Google Sheets service account key from Secret Manager.'}
2025-08-14 13:30:24,741 INFO src.services.gcp.secret_manager Successfully accessed secret 'google-sheets-service-account-key'.
2025-08-14 13:30:24,742 INFO src.services.google_sheets.api_client {'message': 'Google Sheets credentials successfully retrieved and cached.'}
2025-08-14 13:30:24,745 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:30:24,748 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 13:30:25,651 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'rows_to_write': 705}
2025-08-14 13:30:25,940 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'updated_cells': 2820}
2025-08-14 13:30:26,628 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 13:30:26,628 INFO __main__ Overwriting 'Shipped_Orders_Data' tab with 649 rows...
2025-08-14 13:30:26,629 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'OrderNumber': 'object'}}
2025-08-14 13:30:26,630 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'OrderNumber': ['669495', '669455', '669445']}}
2025-08-14 13:30:26,632 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 13:30:26,633 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:30:26,638 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 13:30:27,062 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'rows_to_write': 650}
2025-08-14 13:30:27,295 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'updated_cells': 1300}
2025-08-14 13:30:27,836 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 13:30:27,837 INFO __main__ Fetching existing 52-week history for update...
2025-08-14 13:30:27,837 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 13:30:27,840 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:30:27,846 DEBUG src.services.google_sheets.api_client {'message': 'Fetching data from Google Sheet', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'range': "'ORA_Weekly_Shipped_History'!A:ZZ"}
2025-08-14 13:30:28,272 INFO src.services.google_sheets.api_client {'message': 'Successfully retrieved data from Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_count': 52}
2025-08-14 13:30:28,273 INFO __main__ Starting incremental update of the 52-week history tab...
2025-08-14 13:30:28,281 INFO __main__ Current week starts on: 2025-08-11
2025-08-14 13:30:28,284 INFO src.services.data_processing.shipment_processor Aggregating weekly shipment history for SKUs: ['17612', '17904', '17914', '18675', '18795']...
2025-08-14 13:30:28,284 WARNING src.services.data_processing.shipment_processor No data found for target SKUs within the raw shipment data.
2025-08-14 13:30:28,285 WARNING __main__ Aggregation of current week's data resulted in an empty DataFrame.
2025-08-14 13:30:28,286 INFO __main__ Overwriting 'ORA_Weekly_Shipped_History' with updated 52-week history...
2025-08-14 13:30:28,287 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Start Date': 'object', 'Stop Date': 'object', '17612': 'object', '17904': 'object', '17914': 'object', '18675': 'object', '18795': 'object'}}
2025-08-14 13:30:28,288 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Start Date': ['2024-08-19', '2024-08-26', '2024-09-02'], 'Stop Date': ['2024-08-25', '2024-09-01', '2024-09-08'], '17612': ['454', '592', '406'], '17904': ['8', '11', '0'], '17914': ['18', '27', '19'], '18675': ['1', '14', '2'], '18795': ['0', '0', '0']}}
2025-08-14 13:30:28,288 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 13:30:28,290 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:30:28,293 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History'}
2025-08-14 13:30:28,749 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_to_write': 52}
2025-08-14 13:30:28,937 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'updated_cells': 364}
2025-08-14 13:30:29,444 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History'}
2025-08-14 13:30:29,446 INFO __main__ --- Daily Shipment Processor finished successfully! ---
2025-08-14 13:37:44,965 INFO settings SERVICE_ACCOUNT_KEY_PATH is set to: C:\Users\NathanNeely\Projects\config\ora-automation-project-dev-25acb5551197.json
2025-08-14 13:37:44,966 INFO settings File exists: True
2025-08-14 13:37:44,967 INFO settings First 100 chars of key file: {
  "type": "service_account",
  "project_id": "ora-automation-project-dev",
  "private_key_id": "64
2025-08-14 13:37:45,627 INFO __main__ --- Starting Daily Shipment Processor ---
2025-08-14 13:37:45,628 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Key from Secret Manager...
2025-08-14 13:37:45,993 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-key'.
2025-08-14 13:37:45,993 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Secret from Secret Manager...
2025-08-14 13:37:46,256 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-secret'.
2025-08-14 13:37:46,257 INFO __main__ Using rolling 32-day date range: 2025-07-13 to 2025-08-14
2025-08-14 13:37:46,257 INFO src.services.shipstation.api_client Starting raw shipment fetch from 2025-07-13 with includeShipmentItems=true and status='shipped'...
2025-08-14 13:37:46,258 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 13:37:46,965 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 13:37:46,978 INFO src.services.shipstation.api_client Fetched page 1 of 2. Total shipments so far: 500
2025-08-14 13:37:46,979 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 13:37:47,497 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 13:37:47,500 INFO src.services.shipstation.api_client Fetched page 2 of 2. Total shipments so far: 705
2025-08-14 13:37:47,500 INFO src.services.shipstation.api_client Finished fetching ShipStation shipments. Total retrieved: 705
2025-08-14 13:37:47,501 INFO __main__ Processing 704 non-voided shipments.
2025-08-14 13:37:47,501 INFO __main__ Processing data for Shipped_Items_Data tab...
2025-08-14 13:37:47,501 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Items_Data tab...
2025-08-14 13:37:47,520 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 704 rows.
2025-08-14 13:37:47,521 INFO __main__ Processing data for Shipped_Orders_Data tab...
2025-08-14 13:37:47,521 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Orders_Data tab...
2025-08-14 13:37:47,537 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 649 unique order rows.
2025-08-14 13:37:47,537 INFO __main__ Overwriting 'Shipped_Items_Data' tab with 704 rows...
2025-08-14 13:37:47,538 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'SKU - Lot': 'object', 'Quantity Shipped': 'int64', 'Base SKU': 'object'}}
2025-08-14 13:37:47,544 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'SKU - Lot': ['17612 - 250195', '17612 - 250195', '17612 - 250195'], 'Quantity Shipped': [6, 2, 6], 'Base SKU': ['17612', '17612', '17612']}}
2025-08-14 13:37:47,549 DEBUG src.services.google_sheets.api_client {'message': 'Attempting to retrieve Google Sheets service account key from Secret Manager.'}
2025-08-14 13:37:48,142 INFO src.services.gcp.secret_manager Successfully accessed secret 'google-sheets-service-account-key'.
2025-08-14 13:37:48,145 INFO src.services.google_sheets.api_client {'message': 'Google Sheets credentials successfully retrieved and cached.'}
2025-08-14 13:37:48,148 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:37:48,153 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 13:37:49,150 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'rows_to_write': 705}
2025-08-14 13:37:49,450 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'updated_cells': 2820}
2025-08-14 13:37:50,193 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 13:37:50,195 INFO __main__ Overwriting 'Shipped_Orders_Data' tab with 649 rows...
2025-08-14 13:37:50,196 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'OrderNumber': 'object'}}
2025-08-14 13:37:50,197 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'OrderNumber': ['669495', '669455', '669445']}}
2025-08-14 13:37:50,199 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 13:37:50,201 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:37:50,207 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 13:37:50,627 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'rows_to_write': 650}
2025-08-14 13:37:50,837 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'updated_cells': 1300}
2025-08-14 13:37:51,329 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 13:37:51,329 INFO __main__ Fetching existing 52-week history for update...
2025-08-14 13:37:51,329 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 13:37:51,331 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:37:51,337 DEBUG src.services.google_sheets.api_client {'message': 'Fetching data from Google Sheet', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'range': "'ORA_Weekly_Shipped_History'!A:ZZ"}
2025-08-14 13:37:51,903 INFO src.services.google_sheets.api_client {'message': 'Successfully retrieved data from Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_count': 52}
2025-08-14 13:37:51,907 INFO __main__ Starting incremental update of the 52-week history tab...
2025-08-14 13:37:51,917 INFO __main__ Current week starts on: 2025-08-11
2025-08-14 13:37:51,918 CRITICAL __main__ An unhandled error occurred in the daily shipment processor: 'SKU'
Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'SKU'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\daily_shipment_processor.py", line 213, in run_daily_shipment_pull
    updated_history_df = update_weekly_history_incrementally(items_df.copy(), existing_history_df.copy(), target_skus)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\daily_shipment_processor.py", line 71, in update_weekly_history_incrementally
    logger.debug(daily_items_df[daily_items_df['SKU'] == '17612'])
                                ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\pandas\core\frame.py", line 4107, in __getitem__
    indexer = self.columns.get_loc(key)
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'SKU'
2025-08-14 13:41:21,028 INFO settings SERVICE_ACCOUNT_KEY_PATH is set to: C:\Users\NathanNeely\Projects\config\ora-automation-project-dev-25acb5551197.json
2025-08-14 13:41:21,028 INFO settings File exists: True
2025-08-14 13:41:21,029 INFO settings First 100 chars of key file: {
  "type": "service_account",
  "project_id": "ora-automation-project-dev",
  "private_key_id": "64
2025-08-14 13:41:21,928 INFO __main__ --- Starting Daily Shipment Processor ---
2025-08-14 13:41:21,929 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Key from Secret Manager...
2025-08-14 13:41:22,242 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-key'.
2025-08-14 13:41:22,243 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Secret from Secret Manager...
2025-08-14 13:41:22,510 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-secret'.
2025-08-14 13:41:22,510 INFO __main__ Using rolling 32-day date range: 2025-07-13 to 2025-08-14
2025-08-14 13:41:22,510 INFO src.services.shipstation.api_client Starting raw shipment fetch from 2025-07-13 with includeShipmentItems=true and status='shipped'...
2025-08-14 13:41:22,511 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 13:41:23,170 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 13:41:23,181 INFO src.services.shipstation.api_client Fetched page 1 of 2. Total shipments so far: 500
2025-08-14 13:41:23,182 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 13:41:23,688 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 13:41:23,691 INFO src.services.shipstation.api_client Fetched page 2 of 2. Total shipments so far: 705
2025-08-14 13:41:23,692 INFO src.services.shipstation.api_client Finished fetching ShipStation shipments. Total retrieved: 705
2025-08-14 13:41:23,692 INFO __main__ Processing 704 non-voided shipments.
2025-08-14 13:41:23,693 INFO __main__ Processing data for Shipped_Items_Data tab...
2025-08-14 13:41:23,693 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Items_Data tab...
2025-08-14 13:41:23,715 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 704 rows.
2025-08-14 13:41:23,716 INFO __main__ Processing data for Shipped_Orders_Data tab...
2025-08-14 13:41:23,716 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Orders_Data tab...
2025-08-14 13:41:23,727 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 649 unique order rows.
2025-08-14 13:41:23,727 INFO __main__ Overwriting 'Shipped_Items_Data' tab with 704 rows...
2025-08-14 13:41:23,729 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'SKU - Lot': 'object', 'Quantity Shipped': 'int64', 'Base SKU': 'object'}}
2025-08-14 13:41:23,732 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'SKU - Lot': ['17612 - 250195', '17612 - 250195', '17612 - 250195'], 'Quantity Shipped': [6, 2, 6], 'Base SKU': ['17612', '17612', '17612']}}
2025-08-14 13:41:23,735 DEBUG src.services.google_sheets.api_client {'message': 'Attempting to retrieve Google Sheets service account key from Secret Manager.'}
2025-08-14 13:41:24,139 INFO src.services.gcp.secret_manager Successfully accessed secret 'google-sheets-service-account-key'.
2025-08-14 13:41:24,140 INFO src.services.google_sheets.api_client {'message': 'Google Sheets credentials successfully retrieved and cached.'}
2025-08-14 13:41:24,147 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:41:24,152 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 13:41:25,028 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'rows_to_write': 705}
2025-08-14 13:41:25,288 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'updated_cells': 2820}
2025-08-14 13:41:25,882 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 13:41:25,883 INFO __main__ Overwriting 'Shipped_Orders_Data' tab with 649 rows...
2025-08-14 13:41:25,883 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'OrderNumber': 'object'}}
2025-08-14 13:41:25,884 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'OrderNumber': ['669495', '669455', '669445']}}
2025-08-14 13:41:25,886 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 13:41:25,888 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:41:25,893 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 13:41:26,464 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'rows_to_write': 650}
2025-08-14 13:41:26,676 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'updated_cells': 1300}
2025-08-14 13:41:27,215 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 13:41:27,216 INFO __main__ Fetching existing 52-week history for update...
2025-08-14 13:41:27,216 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 13:41:27,219 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:41:27,228 DEBUG src.services.google_sheets.api_client {'message': 'Fetching data from Google Sheet', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'range': "'ORA_Weekly_Shipped_History'!A:ZZ"}
2025-08-14 13:41:27,959 INFO src.services.google_sheets.api_client {'message': 'Successfully retrieved data from Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_count': 52}
2025-08-14 13:41:27,960 INFO __main__ Starting incremental update of the 52-week history tab...
2025-08-14 13:41:27,963 INFO __main__ Current week starts on: 2025-08-11
2025-08-14 13:41:27,967 CRITICAL __main__ An unhandled error occurred in the daily shipment processor: 'SKU'
Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'SKU'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\daily_shipment_processor.py", line 213, in run_daily_shipment_pull
    updated_history_df = update_weekly_history_incrementally(items_df.copy(), existing_history_df.copy(), target_skus)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\daily_shipment_processor.py", line 73, in update_weekly_history_incrementally
    logger.debug(existing_history_df[existing_history_df['SKU'] == '17612'])
                                     ~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\pandas\core\frame.py", line 4107, in __getitem__
    indexer = self.columns.get_loc(key)
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\venv\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'SKU'
2025-08-14 13:43:28,840 INFO settings SERVICE_ACCOUNT_KEY_PATH is set to: C:\Users\NathanNeely\Projects\config\ora-automation-project-dev-25acb5551197.json
2025-08-14 13:43:28,841 INFO settings File exists: True
2025-08-14 13:43:28,841 INFO settings First 100 chars of key file: {
  "type": "service_account",
  "project_id": "ora-automation-project-dev",
  "private_key_id": "64
2025-08-14 13:43:29,529 INFO __main__ --- Starting Daily Shipment Processor ---
2025-08-14 13:43:29,530 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Key from Secret Manager...
2025-08-14 13:43:29,908 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-key'.
2025-08-14 13:43:29,908 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Secret from Secret Manager...
2025-08-14 13:43:30,184 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-secret'.
2025-08-14 13:43:30,185 INFO __main__ Using rolling 32-day date range: 2025-07-13 to 2025-08-14
2025-08-14 13:43:30,186 INFO src.services.shipstation.api_client Starting raw shipment fetch from 2025-07-13 with includeShipmentItems=true and status='shipped'...
2025-08-14 13:43:30,186 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 13:43:30,888 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 13:43:30,895 INFO src.services.shipstation.api_client Fetched page 1 of 2. Total shipments so far: 500
2025-08-14 13:43:30,896 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 13:43:31,377 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 13:43:31,379 INFO src.services.shipstation.api_client Fetched page 2 of 2. Total shipments so far: 705
2025-08-14 13:43:31,380 INFO src.services.shipstation.api_client Finished fetching ShipStation shipments. Total retrieved: 705
2025-08-14 13:43:31,380 INFO __main__ Processing 704 non-voided shipments.
2025-08-14 13:43:31,380 INFO __main__ Processing data for Shipped_Items_Data tab...
2025-08-14 13:43:31,380 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Items_Data tab...
2025-08-14 13:43:31,397 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 704 rows.
2025-08-14 13:43:31,398 INFO __main__ Processing data for Shipped_Orders_Data tab...
2025-08-14 13:43:31,398 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Orders_Data tab...
2025-08-14 13:43:31,406 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 649 unique order rows.
2025-08-14 13:43:31,406 INFO __main__ Overwriting 'Shipped_Items_Data' tab with 704 rows...
2025-08-14 13:43:31,407 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'SKU - Lot': 'object', 'Quantity Shipped': 'int64', 'Base SKU': 'object'}}
2025-08-14 13:43:31,410 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'SKU - Lot': ['17612 - 250195', '17612 - 250195', '17612 - 250195'], 'Quantity Shipped': [6, 2, 6], 'Base SKU': ['17612', '17612', '17612']}}
2025-08-14 13:43:31,414 DEBUG src.services.google_sheets.api_client {'message': 'Attempting to retrieve Google Sheets service account key from Secret Manager.'}
2025-08-14 13:43:31,804 INFO src.services.gcp.secret_manager Successfully accessed secret 'google-sheets-service-account-key'.
2025-08-14 13:43:31,805 INFO src.services.google_sheets.api_client {'message': 'Google Sheets credentials successfully retrieved and cached.'}
2025-08-14 13:43:31,814 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:43:31,817 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 13:43:32,719 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'rows_to_write': 705}
2025-08-14 13:43:32,973 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'updated_cells': 2820}
2025-08-14 13:43:33,546 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 13:43:33,547 INFO __main__ Overwriting 'Shipped_Orders_Data' tab with 649 rows...
2025-08-14 13:43:33,547 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'OrderNumber': 'object'}}
2025-08-14 13:43:33,548 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'OrderNumber': ['669495', '669455', '669445']}}
2025-08-14 13:43:33,549 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 13:43:33,550 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:43:33,556 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 13:43:34,028 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'rows_to_write': 650}
2025-08-14 13:43:34,225 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'updated_cells': 1300}
2025-08-14 13:43:34,700 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 13:43:34,700 INFO __main__ Fetching existing 52-week history for update...
2025-08-14 13:43:34,701 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 13:43:34,703 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:43:34,709 DEBUG src.services.google_sheets.api_client {'message': 'Fetching data from Google Sheet', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'range': "'ORA_Weekly_Shipped_History'!A:ZZ"}
2025-08-14 13:43:35,236 INFO src.services.google_sheets.api_client {'message': 'Successfully retrieved data from Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_count': 52}
2025-08-14 13:43:35,238 INFO __main__ Starting incremental update of the 52-week history tab...
2025-08-14 13:43:35,246 INFO __main__ Current week starts on: 2025-08-11
2025-08-14 13:43:35,256 INFO src.services.data_processing.shipment_processor Aggregating weekly shipment history for SKUs: ['17612', '17904', '17914', '18675', '18795']...
2025-08-14 13:43:35,256 WARNING src.services.data_processing.shipment_processor No data found for target SKUs within the raw shipment data.
2025-08-14 13:43:35,259 WARNING __main__ Aggregation of current week's data resulted in an empty DataFrame.
2025-08-14 13:43:35,260 INFO __main__ Overwriting 'ORA_Weekly_Shipped_History' with updated 52-week history...
2025-08-14 13:43:35,262 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Start Date': 'object', 'Stop Date': 'object', '17612': 'object', '17904': 'object', '17914': 'object', '18675': 'object', '18795': 'object'}}
2025-08-14 13:43:35,265 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Start Date': ['2024-08-19', '2024-08-26', '2024-09-02'], 'Stop Date': ['2024-08-25', '2024-09-01', '2024-09-08'], '17612': ['454', '592', '406'], '17904': ['8', '11', '0'], '17914': ['18', '27', '19'], '18675': ['1', '14', '2'], '18795': ['0', '0', '0']}}
2025-08-14 13:43:35,268 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 13:43:35,273 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:43:35,277 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History'}
2025-08-14 13:43:35,734 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_to_write': 52}
2025-08-14 13:43:35,943 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'updated_cells': 364}
2025-08-14 13:43:36,781 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History'}
2025-08-14 13:43:36,782 INFO __main__ --- Daily Shipment Processor finished successfully! ---
2025-08-14 13:45:09,053 INFO settings SERVICE_ACCOUNT_KEY_PATH is set to: C:\Users\NathanNeely\Projects\config\ora-automation-project-dev-25acb5551197.json
2025-08-14 13:45:09,053 INFO settings File exists: True
2025-08-14 13:45:09,053 INFO settings First 100 chars of key file: {
  "type": "service_account",
  "project_id": "ora-automation-project-dev",
  "private_key_id": "64
2025-08-14 13:45:09,411 INFO __main__ --- Starting Daily Shipment Processor ---
2025-08-14 13:45:09,411 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Key from Secret Manager...
2025-08-14 13:45:09,691 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-key'.
2025-08-14 13:45:09,692 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Secret from Secret Manager...
2025-08-14 13:45:09,968 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-secret'.
2025-08-14 13:45:09,969 INFO __main__ Using rolling 32-day date range: 2025-07-13 to 2025-08-14
2025-08-14 13:45:09,969 INFO src.services.shipstation.api_client Starting raw shipment fetch from 2025-07-13 with includeShipmentItems=true and status='shipped'...
2025-08-14 13:45:09,970 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 13:45:10,739 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 13:45:10,746 INFO src.services.shipstation.api_client Fetched page 1 of 2. Total shipments so far: 500
2025-08-14 13:45:10,747 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 13:45:11,279 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 13:45:11,283 INFO src.services.shipstation.api_client Fetched page 2 of 2. Total shipments so far: 705
2025-08-14 13:45:11,283 INFO src.services.shipstation.api_client Finished fetching ShipStation shipments. Total retrieved: 705
2025-08-14 13:45:11,283 INFO __main__ Processing 704 non-voided shipments.
2025-08-14 13:45:11,283 INFO __main__ Processing data for Shipped_Items_Data tab...
2025-08-14 13:45:11,283 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Items_Data tab...
2025-08-14 13:45:11,291 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 704 rows.
2025-08-14 13:45:11,291 INFO __main__ Processing data for Shipped_Orders_Data tab...
2025-08-14 13:45:11,291 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Orders_Data tab...
2025-08-14 13:45:11,301 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 649 unique order rows.
2025-08-14 13:45:11,301 INFO __main__ Overwriting 'Shipped_Items_Data' tab with 704 rows...
2025-08-14 13:45:11,302 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'SKU - Lot': 'object', 'Quantity Shipped': 'int64', 'Base SKU': 'object'}}
2025-08-14 13:45:11,307 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'SKU - Lot': ['17612 - 250195', '17612 - 250195', '17612 - 250195'], 'Quantity Shipped': [6, 2, 6], 'Base SKU': ['17612', '17612', '17612']}}
2025-08-14 13:45:11,312 DEBUG src.services.google_sheets.api_client {'message': 'Attempting to retrieve Google Sheets service account key from Secret Manager.'}
2025-08-14 13:45:11,703 INFO src.services.gcp.secret_manager Successfully accessed secret 'google-sheets-service-account-key'.
2025-08-14 13:45:11,704 INFO src.services.google_sheets.api_client {'message': 'Google Sheets credentials successfully retrieved and cached.'}
2025-08-14 13:45:11,707 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:45:11,711 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 13:45:12,769 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'rows_to_write': 705}
2025-08-14 13:45:13,042 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'updated_cells': 2820}
2025-08-14 13:45:13,650 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 13:45:13,650 INFO __main__ Overwriting 'Shipped_Orders_Data' tab with 649 rows...
2025-08-14 13:45:13,651 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'OrderNumber': 'object'}}
2025-08-14 13:45:13,651 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'OrderNumber': ['669495', '669455', '669445']}}
2025-08-14 13:45:13,652 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 13:45:13,655 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:45:13,659 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 13:45:14,196 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'rows_to_write': 650}
2025-08-14 13:45:14,430 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'updated_cells': 1300}
2025-08-14 13:45:14,911 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 13:45:14,911 INFO __main__ Fetching existing 52-week history for update...
2025-08-14 13:45:14,912 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 13:45:14,913 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:45:14,920 DEBUG src.services.google_sheets.api_client {'message': 'Fetching data from Google Sheet', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'range': "'ORA_Weekly_Shipped_History'!A:ZZ"}
2025-08-14 13:45:15,431 INFO src.services.google_sheets.api_client {'message': 'Successfully retrieved data from Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_count': 52}
2025-08-14 13:45:15,432 INFO __main__ Starting incremental update of the 52-week history tab...
2025-08-14 13:45:15,435 INFO __main__ Current week starts on: 2025-08-11
2025-08-14 13:45:15,439 INFO src.services.data_processing.shipment_processor Aggregating weekly shipment history for SKUs: ['17612', '17904', '17914', '18675', '18795']...
2025-08-14 13:45:15,439 WARNING src.services.data_processing.shipment_processor No data found for target SKUs within the raw shipment data.
2025-08-14 13:45:15,441 WARNING __main__ Aggregation of current week's data resulted in an empty DataFrame.
2025-08-14 13:45:15,441 INFO __main__ Overwriting 'ORA_Weekly_Shipped_History' with updated 52-week history...
2025-08-14 13:45:15,442 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Start Date': 'object', 'Stop Date': 'object', '17612': 'object', '17904': 'object', '17914': 'object', '18675': 'object', '18795': 'object'}}
2025-08-14 13:45:15,443 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Start Date': ['2024-08-19', '2024-08-26', '2024-09-02'], 'Stop Date': ['2024-08-25', '2024-09-01', '2024-09-08'], '17612': ['454', '592', '406'], '17904': ['8', '11', '0'], '17914': ['18', '27', '19'], '18675': ['1', '14', '2'], '18795': ['0', '0', '0']}}
2025-08-14 13:45:15,444 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 13:45:15,448 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:45:15,450 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History'}
2025-08-14 13:45:16,145 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_to_write': 52}
2025-08-14 13:45:16,343 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'updated_cells': 364}
2025-08-14 13:45:16,845 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History'}
2025-08-14 13:45:16,845 INFO __main__ --- Daily Shipment Processor finished successfully! ---
2025-08-14 13:47:50,006 INFO settings SERVICE_ACCOUNT_KEY_PATH is set to: C:\Users\NathanNeely\Projects\config\ora-automation-project-dev-25acb5551197.json
2025-08-14 13:47:50,007 INFO settings File exists: True
2025-08-14 13:47:50,007 INFO settings First 100 chars of key file: {
  "type": "service_account",
  "project_id": "ora-automation-project-dev",
  "private_key_id": "64
2025-08-14 13:47:50,332 INFO __main__ --- Starting Daily Shipment Processor ---
2025-08-14 13:47:50,332 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Key from Secret Manager...
2025-08-14 13:47:50,612 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-key'.
2025-08-14 13:47:50,612 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Secret from Secret Manager...
2025-08-14 13:47:50,872 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-secret'.
2025-08-14 13:47:50,872 INFO __main__ Using rolling 32-day date range: 2025-07-13 to 2025-08-14
2025-08-14 13:47:50,873 INFO src.services.shipstation.api_client Starting raw shipment fetch from 2025-07-13 with includeShipmentItems=true and status='shipped'...
2025-08-14 13:47:50,873 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 13:47:51,503 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 13:47:51,511 INFO src.services.shipstation.api_client Fetched page 1 of 2. Total shipments so far: 500
2025-08-14 13:47:51,512 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 13:47:52,052 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 13:47:52,054 INFO src.services.shipstation.api_client Fetched page 2 of 2. Total shipments so far: 705
2025-08-14 13:47:52,054 INFO src.services.shipstation.api_client Finished fetching ShipStation shipments. Total retrieved: 705
2025-08-14 13:47:52,055 INFO __main__ Processing 704 non-voided shipments.
2025-08-14 13:47:52,055 INFO __main__ Processing data for Shipped_Items_Data tab...
2025-08-14 13:47:52,055 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Items_Data tab...
2025-08-14 13:47:52,061 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 704 rows.
2025-08-14 13:47:52,061 INFO __main__ Processing data for Shipped_Orders_Data tab...
2025-08-14 13:47:52,061 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Orders_Data tab...
2025-08-14 13:47:52,067 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 649 unique order rows.
2025-08-14 13:47:52,067 INFO __main__ Overwriting 'Shipped_Items_Data' tab with 704 rows...
2025-08-14 13:47:52,068 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'SKU - Lot': 'object', 'Quantity Shipped': 'int64', 'Base SKU': 'object'}}
2025-08-14 13:47:52,069 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'SKU - Lot': ['17612 - 250195', '17612 - 250195', '17612 - 250195'], 'Quantity Shipped': [6, 2, 6], 'Base SKU': ['17612', '17612', '17612']}}
2025-08-14 13:47:52,071 DEBUG src.services.google_sheets.api_client {'message': 'Attempting to retrieve Google Sheets service account key from Secret Manager.'}
2025-08-14 13:47:52,315 INFO src.services.gcp.secret_manager Successfully accessed secret 'google-sheets-service-account-key'.
2025-08-14 13:47:52,318 INFO src.services.google_sheets.api_client {'message': 'Google Sheets credentials successfully retrieved and cached.'}
2025-08-14 13:47:52,322 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:47:52,326 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 13:47:53,119 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'rows_to_write': 705}
2025-08-14 13:47:53,391 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'updated_cells': 2820}
2025-08-14 13:47:53,895 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 13:47:53,896 INFO __main__ Overwriting 'Shipped_Orders_Data' tab with 649 rows...
2025-08-14 13:47:53,896 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'OrderNumber': 'object'}}
2025-08-14 13:47:53,897 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'OrderNumber': ['669495', '669455', '669445']}}
2025-08-14 13:47:53,898 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 13:47:53,899 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:47:53,902 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 13:47:54,328 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'rows_to_write': 650}
2025-08-14 13:47:54,570 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'updated_cells': 1300}
2025-08-14 13:47:55,071 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 13:47:55,071 INFO __main__ Fetching existing 52-week history for update...
2025-08-14 13:47:55,072 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 13:47:55,073 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:47:55,077 DEBUG src.services.google_sheets.api_client {'message': 'Fetching data from Google Sheet', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'range': "'ORA_Weekly_Shipped_History'!A:ZZ"}
2025-08-14 13:47:55,466 INFO src.services.google_sheets.api_client {'message': 'Successfully retrieved data from Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_count': 52}
2025-08-14 13:47:55,467 INFO __main__ Starting incremental update of the 52-week history tab...
2025-08-14 13:47:55,468 INFO __main__ Current week starts on: 2025-08-11
2025-08-14 13:47:55,472 INFO src.services.data_processing.shipment_processor Aggregating weekly shipment history for SKUs: ['17612', '17904', '17914', '18675', '18795']...
2025-08-14 13:47:55,473 WARNING src.services.data_processing.shipment_processor No data found for target SKUs within the raw shipment data.
2025-08-14 13:47:55,473 WARNING __main__ Aggregation of current week's data resulted in an empty DataFrame.
2025-08-14 13:47:55,473 INFO __main__ Overwriting 'ORA_Weekly_Shipped_History' with updated 52-week history...
2025-08-14 13:47:55,475 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Start Date': 'object', 'Stop Date': 'object', '17612': 'object', '17904': 'object', '17914': 'object', '18675': 'object', '18795': 'object'}}
2025-08-14 13:47:55,475 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Start Date': ['2024-08-19', '2024-08-26', '2024-09-02'], 'Stop Date': ['2024-08-25', '2024-09-01', '2024-09-08'], '17612': ['454', '592', '406'], '17904': ['8', '11', '0'], '17914': ['18', '27', '19'], '18675': ['1', '14', '2'], '18795': ['0', '0', '0']}}
2025-08-14 13:47:55,476 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 13:47:55,478 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:47:55,480 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History'}
2025-08-14 13:47:55,877 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_to_write': 52}
2025-08-14 13:47:56,065 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'updated_cells': 364}
2025-08-14 13:47:56,546 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History'}
2025-08-14 13:47:56,546 INFO __main__ --- Daily Shipment Processor finished successfully! ---
2025-08-14 13:50:25,860 INFO settings SERVICE_ACCOUNT_KEY_PATH is set to: C:\Users\NathanNeely\Projects\config\ora-automation-project-dev-25acb5551197.json
2025-08-14 13:50:25,860 INFO settings File exists: True
2025-08-14 13:50:25,861 INFO settings First 100 chars of key file: {
  "type": "service_account",
  "project_id": "ora-automation-project-dev",
  "private_key_id": "64
2025-08-14 13:50:26,258 INFO __main__ --- Starting Daily Shipment Processor ---
2025-08-14 13:50:26,259 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Key from Secret Manager...
2025-08-14 13:50:26,603 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-key'.
2025-08-14 13:50:26,604 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Secret from Secret Manager...
2025-08-14 13:50:26,875 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-secret'.
2025-08-14 13:50:26,875 INFO __main__ Using rolling 32-day date range: 2025-07-13 to 2025-08-14
2025-08-14 13:50:26,876 INFO src.services.shipstation.api_client Starting raw shipment fetch from 2025-07-13 with includeShipmentItems=true and status='shipped'...
2025-08-14 13:50:26,877 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 13:50:27,575 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 13:50:27,582 INFO src.services.shipstation.api_client Fetched page 1 of 2. Total shipments so far: 500
2025-08-14 13:50:27,582 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 13:50:28,092 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 13:50:28,094 INFO src.services.shipstation.api_client Fetched page 2 of 2. Total shipments so far: 705
2025-08-14 13:50:28,094 INFO src.services.shipstation.api_client Finished fetching ShipStation shipments. Total retrieved: 705
2025-08-14 13:50:28,095 INFO __main__ Processing 704 non-voided shipments.
2025-08-14 13:50:28,095 INFO __main__ Processing data for Shipped_Items_Data tab...
2025-08-14 13:50:28,095 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Items_Data tab...
2025-08-14 13:50:28,101 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 704 rows.
2025-08-14 13:50:28,101 INFO __main__ Processing data for Shipped_Orders_Data tab...
2025-08-14 13:50:28,102 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Orders_Data tab...
2025-08-14 13:50:28,107 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 649 unique order rows.
2025-08-14 13:50:28,108 INFO __main__ Overwriting 'Shipped_Items_Data' tab with 704 rows...
2025-08-14 13:50:28,108 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'SKU - Lot': 'object', 'Quantity Shipped': 'int64', 'Base SKU': 'object'}}
2025-08-14 13:50:28,111 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'SKU - Lot': ['17612 - 250195', '17612 - 250195', '17612 - 250195'], 'Quantity Shipped': [6, 2, 6], 'Base SKU': ['17612', '17612', '17612']}}
2025-08-14 13:50:28,113 DEBUG src.services.google_sheets.api_client {'message': 'Attempting to retrieve Google Sheets service account key from Secret Manager.'}
2025-08-14 13:50:28,367 INFO src.services.gcp.secret_manager Successfully accessed secret 'google-sheets-service-account-key'.
2025-08-14 13:50:28,368 INFO src.services.google_sheets.api_client {'message': 'Google Sheets credentials successfully retrieved and cached.'}
2025-08-14 13:50:28,373 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:50:28,375 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 13:50:29,166 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'rows_to_write': 705}
2025-08-14 13:50:29,448 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'updated_cells': 2820}
2025-08-14 13:50:29,982 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 13:50:29,983 INFO __main__ Overwriting 'Shipped_Orders_Data' tab with 649 rows...
2025-08-14 13:50:29,984 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'OrderNumber': 'object'}}
2025-08-14 13:50:29,985 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'OrderNumber': ['669495', '669455', '669445']}}
2025-08-14 13:50:29,987 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 13:50:29,990 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:50:29,993 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 13:50:30,417 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'rows_to_write': 650}
2025-08-14 13:50:30,686 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'updated_cells': 1300}
2025-08-14 13:50:31,194 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 13:50:31,194 INFO __main__ Fetching existing 52-week history for update...
2025-08-14 13:50:31,194 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 13:50:31,197 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:50:31,207 DEBUG src.services.google_sheets.api_client {'message': 'Fetching data from Google Sheet', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'range': "'ORA_Weekly_Shipped_History'!A:ZZ"}
2025-08-14 13:50:31,788 INFO src.services.google_sheets.api_client {'message': 'Successfully retrieved data from Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_count': 52}
2025-08-14 13:50:31,798 INFO __main__ Starting incremental update of the 52-week history tab...
2025-08-14 13:50:31,805 INFO __main__ Current week starts on: 2025-08-11
2025-08-14 13:50:31,811 INFO __main__ Unique Ship Dates in daily_items_df: [datetime.date(2025, 7, 14), datetime.date(2025, 7, 15), datetime.date(2025, 7, 16), datetime.date(2025, 7, 17), datetime.date(2025, 7, 18), datetime.date(2025, 7, 21), datetime.date(2025, 7, 22), datetime.date(2025, 7, 23), datetime.date(2025, 7, 24), datetime.date(2025, 7, 25), datetime.date(2025, 7, 28), datetime.date(2025, 7, 29), datetime.date(2025, 7, 30), datetime.date(2025, 7, 31), datetime.date(2025, 8, 1), datetime.date(2025, 8, 4), datetime.date(2025, 8, 5), datetime.date(2025, 8, 6), datetime.date(2025, 8, 7), datetime.date(2025, 8, 8), datetime.date(2025, 8, 11), datetime.date(2025, 8, 12), datetime.date(2025, 8, 13), datetime.date(2025, 8, 14)]
2025-08-14 13:50:31,813 INFO __main__ Min Ship Date: 2025-07-14, Max Ship Date: 2025-08-14
2025-08-14 13:50:31,818 INFO __main__ Current week starts on: 2025-08-11
2025-08-14 13:50:31,832 INFO src.services.data_processing.shipment_processor Aggregating weekly shipment history for SKUs: ['17612', '17904', '17914', '18675', '18795']...
2025-08-14 13:50:31,832 WARNING src.services.data_processing.shipment_processor No data found for target SKUs within the raw shipment data.
2025-08-14 13:50:31,833 WARNING __main__ Aggregation of current week's data resulted in an empty DataFrame.
2025-08-14 13:50:31,834 INFO __main__ Overwriting 'ORA_Weekly_Shipped_History' with updated 52-week history...
2025-08-14 13:50:31,835 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Start Date': 'object', 'Stop Date': 'object', '17612': 'object', '17904': 'object', '17914': 'object', '18675': 'object', '18795': 'object'}}
2025-08-14 13:50:31,835 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Start Date': ['2024-08-19', '2024-08-26', '2024-09-02'], 'Stop Date': ['2024-08-25', '2024-09-01', '2024-09-08'], '17612': ['454', '592', '406'], '17904': ['8', '11', '0'], '17914': ['18', '27', '19'], '18675': ['1', '14', '2'], '18795': ['0', '0', '0']}}
2025-08-14 13:50:31,840 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 13:50:31,845 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:50:31,850 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History'}
2025-08-14 13:50:32,546 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_to_write': 52}
2025-08-14 13:50:32,743 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'updated_cells': 364}
2025-08-14 13:50:33,250 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History'}
2025-08-14 13:50:33,251 INFO __main__ --- Daily Shipment Processor finished successfully! ---
2025-08-14 13:51:48,332 INFO settings SERVICE_ACCOUNT_KEY_PATH is set to: C:\Users\NathanNeely\Projects\config\ora-automation-project-dev-25acb5551197.json
2025-08-14 13:51:48,333 INFO settings File exists: True
2025-08-14 13:51:48,333 INFO settings First 100 chars of key file: {
  "type": "service_account",
  "project_id": "ora-automation-project-dev",
  "private_key_id": "64
2025-08-14 13:51:48,658 INFO __main__ --- Starting Daily Shipment Processor ---
2025-08-14 13:51:48,659 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Key from Secret Manager...
2025-08-14 13:51:48,984 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-key'.
2025-08-14 13:51:48,985 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Secret from Secret Manager...
2025-08-14 13:51:49,229 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-secret'.
2025-08-14 13:51:49,229 INFO __main__ Using rolling 32-day date range: 2025-07-13 to 2025-08-14
2025-08-14 13:51:49,230 INFO src.services.shipstation.api_client Starting raw shipment fetch from 2025-07-13 with includeShipmentItems=true and status='shipped'...
2025-08-14 13:51:49,230 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 13:51:49,936 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 13:51:49,943 INFO src.services.shipstation.api_client Fetched page 1 of 2. Total shipments so far: 500
2025-08-14 13:51:49,945 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 13:51:50,438 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 13:51:50,440 INFO src.services.shipstation.api_client Fetched page 2 of 2. Total shipments so far: 705
2025-08-14 13:51:50,440 INFO src.services.shipstation.api_client Finished fetching ShipStation shipments. Total retrieved: 705
2025-08-14 13:51:50,441 INFO __main__ Processing 704 non-voided shipments.
2025-08-14 13:51:50,441 INFO __main__ Processing data for Shipped_Items_Data tab...
2025-08-14 13:51:50,442 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Items_Data tab...
2025-08-14 13:51:50,447 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 704 rows.
2025-08-14 13:51:50,447 INFO __main__ Processing data for Shipped_Orders_Data tab...
2025-08-14 13:51:50,447 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Orders_Data tab...
2025-08-14 13:51:50,453 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 649 unique order rows.
2025-08-14 13:51:50,453 INFO __main__ Overwriting 'Shipped_Items_Data' tab with 704 rows...
2025-08-14 13:51:50,453 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'SKU - Lot': 'object', 'Quantity Shipped': 'int64', 'Base SKU': 'object'}}
2025-08-14 13:51:50,457 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'SKU - Lot': ['17612 - 250195', '17612 - 250195', '17612 - 250195'], 'Quantity Shipped': [6, 2, 6], 'Base SKU': ['17612', '17612', '17612']}}
2025-08-14 13:51:50,460 DEBUG src.services.google_sheets.api_client {'message': 'Attempting to retrieve Google Sheets service account key from Secret Manager.'}
2025-08-14 13:51:50,713 INFO src.services.gcp.secret_manager Successfully accessed secret 'google-sheets-service-account-key'.
2025-08-14 13:51:50,715 INFO src.services.google_sheets.api_client {'message': 'Google Sheets credentials successfully retrieved and cached.'}
2025-08-14 13:51:50,720 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:51:50,723 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 13:51:51,634 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'rows_to_write': 705}
2025-08-14 13:51:51,927 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'updated_cells': 2820}
2025-08-14 13:51:52,489 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 13:51:52,489 INFO __main__ Overwriting 'Shipped_Orders_Data' tab with 649 rows...
2025-08-14 13:51:52,490 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'OrderNumber': 'object'}}
2025-08-14 13:51:52,491 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'OrderNumber': ['669495', '669455', '669445']}}
2025-08-14 13:51:52,492 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 13:51:52,493 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:51:52,497 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 13:51:52,887 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'rows_to_write': 650}
2025-08-14 13:51:53,102 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'updated_cells': 1300}
2025-08-14 13:51:53,722 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 13:51:53,723 INFO __main__ Fetching existing 52-week history for update...
2025-08-14 13:51:53,723 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 13:51:53,727 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:51:53,731 DEBUG src.services.google_sheets.api_client {'message': 'Fetching data from Google Sheet', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'range': "'ORA_Weekly_Shipped_History'!A:ZZ"}
2025-08-14 13:51:54,133 INFO src.services.google_sheets.api_client {'message': 'Successfully retrieved data from Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_count': 52}
2025-08-14 13:51:54,134 CRITICAL __main__ An unhandled error occurred in the daily shipment processor: cannot access local variable 'start_of_current_week' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\daily_shipment_processor.py", line 235, in run_daily_shipment_pull
    updated_history_df = update_weekly_history_incrementally(items_df.copy(), existing_history_df.copy(), target_skus)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\daily_shipment_processor.py", line 48, in update_weekly_history_incrementally
    current_week_items_df = daily_items_df[daily_items_df['Ship Date'] >= start_of_current_week].copy()
                                                                          ^^^^^^^^^^^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'start_of_current_week' where it is not associated with a value
2025-08-14 13:52:34,200 INFO settings SERVICE_ACCOUNT_KEY_PATH is set to: C:\Users\NathanNeely\Projects\config\ora-automation-project-dev-25acb5551197.json
2025-08-14 13:52:34,200 INFO settings File exists: True
2025-08-14 13:52:34,200 INFO settings First 100 chars of key file: {
  "type": "service_account",
  "project_id": "ora-automation-project-dev",
  "private_key_id": "64
2025-08-14 13:52:34,557 INFO __main__ --- Starting Daily Shipment Processor ---
2025-08-14 13:52:34,557 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Key from Secret Manager...
2025-08-14 13:52:34,840 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-key'.
2025-08-14 13:52:34,841 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Secret from Secret Manager...
2025-08-14 13:52:35,125 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-secret'.
2025-08-14 13:52:35,126 INFO __main__ Using rolling 32-day date range: 2025-07-13 to 2025-08-14
2025-08-14 13:52:35,126 INFO src.services.shipstation.api_client Starting raw shipment fetch from 2025-07-13 with includeShipmentItems=true and status='shipped'...
2025-08-14 13:52:35,127 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 13:52:35,848 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 13:52:35,875 INFO src.services.shipstation.api_client Fetched page 1 of 2. Total shipments so far: 500
2025-08-14 13:52:35,876 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 13:52:36,436 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 13:52:36,443 INFO src.services.shipstation.api_client Fetched page 2 of 2. Total shipments so far: 705
2025-08-14 13:52:36,444 INFO src.services.shipstation.api_client Finished fetching ShipStation shipments. Total retrieved: 705
2025-08-14 13:52:36,445 INFO __main__ Processing 704 non-voided shipments.
2025-08-14 13:52:36,446 INFO __main__ Processing data for Shipped_Items_Data tab...
2025-08-14 13:52:36,446 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Items_Data tab...
2025-08-14 13:52:36,458 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 704 rows.
2025-08-14 13:52:36,459 INFO __main__ Processing data for Shipped_Orders_Data tab...
2025-08-14 13:52:36,459 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Orders_Data tab...
2025-08-14 13:52:36,476 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 649 unique order rows.
2025-08-14 13:52:36,476 INFO __main__ Overwriting 'Shipped_Items_Data' tab with 704 rows...
2025-08-14 13:52:36,477 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'SKU - Lot': 'object', 'Quantity Shipped': 'int64', 'Base SKU': 'object'}}
2025-08-14 13:52:36,483 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'SKU - Lot': ['17612 - 250195', '17612 - 250195', '17612 - 250195'], 'Quantity Shipped': [6, 2, 6], 'Base SKU': ['17612', '17612', '17612']}}
2025-08-14 13:52:36,490 DEBUG src.services.google_sheets.api_client {'message': 'Attempting to retrieve Google Sheets service account key from Secret Manager.'}
2025-08-14 13:52:36,845 INFO src.services.gcp.secret_manager Successfully accessed secret 'google-sheets-service-account-key'.
2025-08-14 13:52:36,847 INFO src.services.google_sheets.api_client {'message': 'Google Sheets credentials successfully retrieved and cached.'}
2025-08-14 13:52:36,856 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:52:36,861 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 13:52:37,666 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'rows_to_write': 705}
2025-08-14 13:52:37,960 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'updated_cells': 2820}
2025-08-14 13:52:38,619 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 13:52:38,620 INFO __main__ Overwriting 'Shipped_Orders_Data' tab with 649 rows...
2025-08-14 13:52:38,620 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'OrderNumber': 'object'}}
2025-08-14 13:52:38,620 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'OrderNumber': ['669495', '669455', '669445']}}
2025-08-14 13:52:38,622 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 13:52:38,623 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:52:38,628 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 13:52:39,109 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'rows_to_write': 650}
2025-08-14 13:52:39,414 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'updated_cells': 1300}
2025-08-14 13:52:39,972 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 13:52:39,973 INFO __main__ Fetching existing 52-week history for update...
2025-08-14 13:52:39,973 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 13:52:39,975 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:52:39,980 DEBUG src.services.google_sheets.api_client {'message': 'Fetching data from Google Sheet', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'range': "'ORA_Weekly_Shipped_History'!A:ZZ"}
2025-08-14 13:52:40,493 INFO src.services.google_sheets.api_client {'message': 'Successfully retrieved data from Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_count': 52}
2025-08-14 13:52:40,494 CRITICAL __main__ An unhandled error occurred in the daily shipment processor: cannot access local variable 'start_of_current_week' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\daily_shipment_processor.py", line 235, in run_daily_shipment_pull
    updated_history_df = update_weekly_history_incrementally(items_df.copy(), existing_history_df.copy(), target_skus)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\daily_shipment_processor.py", line 48, in update_weekly_history_incrementally
    current_week_items_df = daily_items_df[daily_items_df['Ship Date'] >= start_of_current_week].copy()
                                                                          ^^^^^^^^^^^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'start_of_current_week' where it is not associated with a value
2025-08-14 13:57:27,856 INFO settings SERVICE_ACCOUNT_KEY_PATH is set to: C:\Users\NathanNeely\Projects\config\ora-automation-project-dev-25acb5551197.json
2025-08-14 13:57:27,856 INFO settings File exists: True
2025-08-14 13:57:27,857 INFO settings First 100 chars of key file: {
  "type": "service_account",
  "project_id": "ora-automation-project-dev",
  "private_key_id": "64
2025-08-14 13:57:28,213 INFO __main__ --- Starting Daily Shipment Processor ---
2025-08-14 13:57:28,213 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Key from Secret Manager...
2025-08-14 13:57:28,533 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-key'.
2025-08-14 13:57:28,534 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Secret from Secret Manager...
2025-08-14 13:57:28,813 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-secret'.
2025-08-14 13:57:28,815 INFO __main__ Using rolling 32-day date range: 2025-07-13 to 2025-08-14
2025-08-14 13:57:28,815 INFO src.services.shipstation.api_client Starting raw shipment fetch from 2025-07-13 with includeShipmentItems=true and status='shipped'...
2025-08-14 13:57:28,815 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 13:57:29,485 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 13:57:29,492 INFO src.services.shipstation.api_client Fetched page 1 of 2. Total shipments so far: 500
2025-08-14 13:57:29,492 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 13:57:30,032 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 13:57:30,035 INFO src.services.shipstation.api_client Fetched page 2 of 2. Total shipments so far: 705
2025-08-14 13:57:30,035 INFO src.services.shipstation.api_client Finished fetching ShipStation shipments. Total retrieved: 705
2025-08-14 13:57:30,035 INFO __main__ Processing 704 non-voided shipments.
2025-08-14 13:57:30,036 INFO __main__ Processing data for Shipped_Items_Data tab...
2025-08-14 13:57:30,036 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Items_Data tab...
2025-08-14 13:57:30,041 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 704 rows.
2025-08-14 13:57:30,041 INFO __main__ Processing data for Shipped_Orders_Data tab...
2025-08-14 13:57:30,042 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Orders_Data tab...
2025-08-14 13:57:30,048 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 649 unique order rows.
2025-08-14 13:57:30,048 INFO __main__ Overwriting 'Shipped_Items_Data' tab with 704 rows...
2025-08-14 13:57:30,050 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'SKU - Lot': 'object', 'Quantity Shipped': 'int64', 'Base SKU': 'object'}}
2025-08-14 13:57:30,052 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'SKU - Lot': ['17612 - 250195', '17612 - 250195', '17612 - 250195'], 'Quantity Shipped': [6, 2, 6], 'Base SKU': ['17612', '17612', '17612']}}
2025-08-14 13:57:30,055 DEBUG src.services.google_sheets.api_client {'message': 'Attempting to retrieve Google Sheets service account key from Secret Manager.'}
2025-08-14 13:57:30,326 INFO src.services.gcp.secret_manager Successfully accessed secret 'google-sheets-service-account-key'.
2025-08-14 13:57:30,327 INFO src.services.google_sheets.api_client {'message': 'Google Sheets credentials successfully retrieved and cached.'}
2025-08-14 13:57:30,330 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:57:30,333 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 13:57:31,233 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'rows_to_write': 705}
2025-08-14 13:57:31,524 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'updated_cells': 2820}
2025-08-14 13:57:32,216 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 13:57:32,216 INFO __main__ Overwriting 'Shipped_Orders_Data' tab with 649 rows...
2025-08-14 13:57:32,218 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'OrderNumber': 'object'}}
2025-08-14 13:57:32,220 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'OrderNumber': ['669495', '669455', '669445']}}
2025-08-14 13:57:32,221 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 13:57:32,223 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:57:32,226 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 13:57:32,649 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'rows_to_write': 650}
2025-08-14 13:57:32,868 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'updated_cells': 1300}
2025-08-14 13:57:33,359 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 13:57:33,360 INFO __main__ Fetching existing 52-week history for update...
2025-08-14 13:57:33,361 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 13:57:33,363 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 13:57:33,370 DEBUG src.services.google_sheets.api_client {'message': 'Fetching data from Google Sheet', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'range': "'ORA_Weekly_Shipped_History'!A:ZZ"}
2025-08-14 13:57:33,928 INFO src.services.google_sheets.api_client {'message': 'Successfully retrieved data from Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_count': 52}
2025-08-14 13:57:33,929 CRITICAL __main__ An unhandled error occurred in the daily shipment processor: cannot access local variable 'start_of_current_week' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\daily_shipment_processor.py", line 247, in run_daily_shipment_pull
    updated_history_df = update_weekly_history_incrementally(items_df.copy(), existing_history_df.copy(), target_skus)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\daily_shipment_processor.py", line 48, in update_weekly_history_incrementally
    current_week_items_df = daily_items_df[daily_items_df['Ship Date'] >= start_of_current_week].copy()
                                                                          ^^^^^^^^^^^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'start_of_current_week' where it is not associated with a value
2025-08-14 14:01:09,105 INFO settings SERVICE_ACCOUNT_KEY_PATH is set to: C:\Users\NathanNeely\Projects\config\ora-automation-project-dev-25acb5551197.json
2025-08-14 14:01:09,105 INFO settings File exists: True
2025-08-14 14:01:09,105 INFO settings First 100 chars of key file: {
  "type": "service_account",
  "project_id": "ora-automation-project-dev",
  "private_key_id": "64
2025-08-14 14:01:09,448 INFO __main__ --- Starting Daily Shipment Processor ---
2025-08-14 14:01:09,449 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Key from Secret Manager...
2025-08-14 14:01:09,725 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-key'.
2025-08-14 14:01:09,727 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Secret from Secret Manager...
2025-08-14 14:01:10,052 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-secret'.
2025-08-14 14:01:10,053 INFO __main__ Using rolling 32-day date range: 2025-07-13 to 2025-08-14
2025-08-14 14:01:10,053 INFO src.services.shipstation.api_client Starting raw shipment fetch from 2025-07-13 with includeShipmentItems=true and status='shipped'...
2025-08-14 14:01:10,054 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 14:01:10,693 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 14:01:10,703 INFO src.services.shipstation.api_client Fetched page 1 of 2. Total shipments so far: 500
2025-08-14 14:01:10,705 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 14:01:11,236 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 14:01:11,240 INFO src.services.shipstation.api_client Fetched page 2 of 2. Total shipments so far: 705
2025-08-14 14:01:11,240 INFO src.services.shipstation.api_client Finished fetching ShipStation shipments. Total retrieved: 705
2025-08-14 14:01:11,241 INFO __main__ Processing 704 non-voided shipments.
2025-08-14 14:01:11,241 INFO __main__ Processing data for Shipped_Items_Data tab...
2025-08-14 14:01:11,241 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Items_Data tab...
2025-08-14 14:01:11,251 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 704 rows.
2025-08-14 14:01:11,251 INFO __main__ Processing data for Shipped_Orders_Data tab...
2025-08-14 14:01:11,252 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Orders_Data tab...
2025-08-14 14:01:11,261 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 649 unique order rows.
2025-08-14 14:01:11,261 INFO __main__ Overwriting 'Shipped_Items_Data' tab with 704 rows...
2025-08-14 14:01:11,262 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'SKU - Lot': 'object', 'Quantity Shipped': 'int64', 'Base SKU': 'object'}}
2025-08-14 14:01:11,263 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'SKU - Lot': ['17612 - 250195', '17612 - 250195', '17612 - 250195'], 'Quantity Shipped': [6, 2, 6], 'Base SKU': ['17612', '17612', '17612']}}
2025-08-14 14:01:11,267 DEBUG src.services.google_sheets.api_client {'message': 'Attempting to retrieve Google Sheets service account key from Secret Manager.'}
2025-08-14 14:01:11,511 INFO src.services.gcp.secret_manager Successfully accessed secret 'google-sheets-service-account-key'.
2025-08-14 14:01:11,512 INFO src.services.google_sheets.api_client {'message': 'Google Sheets credentials successfully retrieved and cached.'}
2025-08-14 14:01:11,515 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:01:11,519 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 14:01:12,399 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'rows_to_write': 705}
2025-08-14 14:01:12,783 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'updated_cells': 2820}
2025-08-14 14:01:13,603 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 14:01:13,603 INFO __main__ Overwriting 'Shipped_Orders_Data' tab with 649 rows...
2025-08-14 14:01:13,604 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'OrderNumber': 'object'}}
2025-08-14 14:01:13,605 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'OrderNumber': ['669495', '669455', '669445']}}
2025-08-14 14:01:13,608 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 14:01:13,611 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:01:13,617 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 14:01:14,297 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'rows_to_write': 650}
2025-08-14 14:01:14,550 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'updated_cells': 1300}
2025-08-14 14:01:15,355 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 14:01:15,355 INFO __main__ Fetching existing 52-week history for update...
2025-08-14 14:01:15,356 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 14:01:15,359 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:01:15,367 DEBUG src.services.google_sheets.api_client {'message': 'Fetching data from Google Sheet', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'range': "'ORA_Weekly_Shipped_History'!A:ZZ"}
2025-08-14 14:01:15,846 INFO src.services.google_sheets.api_client {'message': 'Successfully retrieved data from Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_count': 52}
2025-08-14 14:01:15,847 CRITICAL __main__ An unhandled error occurred in the daily shipment processor: cannot access local variable 'start_of_current_week' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\daily_shipment_processor.py", line 253, in run_daily_shipment_pull
    updated_history_df = update_weekly_history_incrementally(items_df.copy(), existing_history_df.copy(), target_skus)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\daily_shipment_processor.py", line 48, in update_weekly_history_incrementally
    current_week_items_df = daily_items_df[daily_items_df['Ship Date'] >= start_of_current_week].copy()
                                                                          ^^^^^^^^^^^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'start_of_current_week' where it is not associated with a value
2025-08-14 14:05:22,732 INFO settings SERVICE_ACCOUNT_KEY_PATH is set to: C:\Users\NathanNeely\Projects\config\ora-automation-project-dev-25acb5551197.json
2025-08-14 14:05:22,732 INFO settings File exists: True
2025-08-14 14:05:22,733 INFO settings First 100 chars of key file: {
  "type": "service_account",
  "project_id": "ora-automation-project-dev",
  "private_key_id": "64
2025-08-14 14:05:23,085 INFO __main__ --- Starting Daily Shipment Processor ---
2025-08-14 14:05:23,086 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Key from Secret Manager...
2025-08-14 14:05:23,424 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-key'.
2025-08-14 14:05:23,425 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Secret from Secret Manager...
2025-08-14 14:05:23,712 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-secret'.
2025-08-14 14:05:23,713 INFO __main__ Using rolling 32-day date range: 2025-07-13 to 2025-08-14
2025-08-14 14:05:23,714 INFO src.services.shipstation.api_client Starting raw shipment fetch from 2025-07-13 with includeShipmentItems=true and status='shipped'...
2025-08-14 14:05:23,716 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 14:05:24,467 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 14:05:24,473 INFO src.services.shipstation.api_client Fetched page 1 of 2. Total shipments so far: 500
2025-08-14 14:05:24,474 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 14:05:25,013 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 14:05:25,015 INFO src.services.shipstation.api_client Fetched page 2 of 2. Total shipments so far: 705
2025-08-14 14:05:25,016 INFO src.services.shipstation.api_client Finished fetching ShipStation shipments. Total retrieved: 705
2025-08-14 14:05:25,016 INFO __main__ Processing 704 non-voided shipments.
2025-08-14 14:05:25,017 INFO __main__ Processing data for Shipped_Items_Data tab...
2025-08-14 14:05:25,017 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Items_Data tab...
2025-08-14 14:05:25,024 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 704 rows.
2025-08-14 14:05:25,024 INFO __main__ Processing data for Shipped_Orders_Data tab...
2025-08-14 14:05:25,025 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Orders_Data tab...
2025-08-14 14:05:25,030 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 649 unique order rows.
2025-08-14 14:05:25,030 INFO __main__ Overwriting 'Shipped_Items_Data' tab with 704 rows...
2025-08-14 14:05:25,031 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'SKU - Lot': 'object', 'Quantity Shipped': 'int64', 'Base SKU': 'object'}}
2025-08-14 14:05:25,035 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'SKU - Lot': ['17612 - 250195', '17612 - 250195', '17612 - 250195'], 'Quantity Shipped': [6, 2, 6], 'Base SKU': ['17612', '17612', '17612']}}
2025-08-14 14:05:25,039 DEBUG src.services.google_sheets.api_client {'message': 'Attempting to retrieve Google Sheets service account key from Secret Manager.'}
2025-08-14 14:05:25,421 INFO src.services.gcp.secret_manager Successfully accessed secret 'google-sheets-service-account-key'.
2025-08-14 14:05:25,422 INFO src.services.google_sheets.api_client {'message': 'Google Sheets credentials successfully retrieved and cached.'}
2025-08-14 14:05:25,426 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:05:25,428 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 14:05:26,175 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'rows_to_write': 705}
2025-08-14 14:05:26,473 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'updated_cells': 2820}
2025-08-14 14:05:27,067 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 14:05:27,068 INFO __main__ Overwriting 'Shipped_Orders_Data' tab with 649 rows...
2025-08-14 14:05:27,068 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'OrderNumber': 'object'}}
2025-08-14 14:05:27,069 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'OrderNumber': ['669495', '669455', '669445']}}
2025-08-14 14:05:27,070 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 14:05:27,072 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:05:27,075 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 14:05:27,483 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'rows_to_write': 650}
2025-08-14 14:05:27,693 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'updated_cells': 1300}
2025-08-14 14:05:28,174 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 14:05:28,176 INFO __main__ Fetching existing 52-week history for update...
2025-08-14 14:05:28,176 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 14:05:28,180 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:05:28,185 DEBUG src.services.google_sheets.api_client {'message': 'Fetching data from Google Sheet', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'range': "'ORA_Weekly_Shipped_History'!A:ZZ"}
2025-08-14 14:05:28,580 INFO src.services.google_sheets.api_client {'message': 'Successfully retrieved data from Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_count': 52}
2025-08-14 14:05:28,582 INFO __main__ current_week_items_df shape: (109, 4)
2025-08-14 14:05:28,594 INFO __main__ current_week_items_df head:
      Ship Date       SKU - Lot  Quantity Shipped Base SKU
595  2025-08-11  17612 - 250216                 7    17612
596  2025-08-11  17904 - 240276                 1    17904
597  2025-08-11  17612 - 250216                 1    17612
598  2025-08-11  17612 - 250216                 1    17612
599  2025-08-11  17914 - 240286                 6    17914
600  2025-08-11  17612 - 250216                 6    17612
601  2025-08-11  17612 - 250216                 2    17612
602  2025-08-11  17612 - 250216                 2    17612
603  2025-08-11  17612 - 250216                 1    17612
604  2025-08-11  17904 - 240276                 1    17904
2025-08-14 14:05:28,596 INFO __main__ Unique 'Base SKU' values in current_week_items_df: ['17612', '17904', '17914', '18675', '18795']
2025-08-14 14:05:28,596 INFO __main__ Starting incremental update of the 52-week history tab...
2025-08-14 14:05:28,598 INFO __main__ Current week starts on: 2025-08-11
2025-08-14 14:05:28,598 INFO __main__ Unique Ship Dates in daily_items_df: [datetime.date(2025, 7, 14), datetime.date(2025, 7, 15), datetime.date(2025, 7, 16), datetime.date(2025, 7, 17), datetime.date(2025, 7, 18), datetime.date(2025, 7, 21), datetime.date(2025, 7, 22), datetime.date(2025, 7, 23), datetime.date(2025, 7, 24), datetime.date(2025, 7, 25), datetime.date(2025, 7, 28), datetime.date(2025, 7, 29), datetime.date(2025, 7, 30), datetime.date(2025, 7, 31), datetime.date(2025, 8, 1), datetime.date(2025, 8, 4), datetime.date(2025, 8, 5), datetime.date(2025, 8, 6), datetime.date(2025, 8, 7), datetime.date(2025, 8, 8), datetime.date(2025, 8, 11), datetime.date(2025, 8, 12), datetime.date(2025, 8, 13), datetime.date(2025, 8, 14)]
2025-08-14 14:05:28,599 INFO __main__ Min Ship Date: 2025-07-14, Max Ship Date: 2025-08-14
2025-08-14 14:05:28,600 INFO __main__ current_week_items_df shape: (109, 4)
2025-08-14 14:05:28,603 INFO __main__ current_week_items_df head:
      Ship Date       SKU - Lot  Quantity Shipped Base SKU
595  2025-08-11  17612 - 250216                 7    17612
596  2025-08-11  17904 - 240276                 1    17904
597  2025-08-11  17612 - 250216                 1    17612
598  2025-08-11  17612 - 250216                 1    17612
599  2025-08-11  17914 - 240286                 6    17914
600  2025-08-11  17612 - 250216                 6    17612
601  2025-08-11  17612 - 250216                 2    17612
602  2025-08-11  17612 - 250216                 2    17612
603  2025-08-11  17612 - 250216                 1    17612
604  2025-08-11  17904 - 240276                 1    17904
2025-08-14 14:05:28,603 INFO __main__ Unique 'Base SKU' values in current_week_items_df: ['17612', '17904', '17914', '18675', '18795']
2025-08-14 14:05:28,604 INFO __main__ Current week starts on: 2025-08-11
2025-08-14 14:05:28,608 INFO src.services.data_processing.shipment_processor Aggregating weekly shipment history for SKUs: ['17612', '17904', '17914', '18675', '18795']...
2025-08-14 14:05:28,608 WARNING src.services.data_processing.shipment_processor No data found for target SKUs within the raw shipment data.
2025-08-14 14:05:28,609 WARNING __main__ Aggregation of current week's data resulted in an empty DataFrame.
2025-08-14 14:05:28,609 INFO __main__ Overwriting 'ORA_Weekly_Shipped_History' with updated 52-week history...
2025-08-14 14:05:28,610 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Start Date': 'object', 'Stop Date': 'object', '17612': 'object', '17904': 'object', '17914': 'object', '18675': 'object', '18795': 'object'}}
2025-08-14 14:05:28,611 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Start Date': ['2024-08-19', '2024-08-26', '2024-09-02'], 'Stop Date': ['2024-08-25', '2024-09-01', '2024-09-08'], '17612': ['454', '592', '406'], '17904': ['8', '11', '0'], '17914': ['18', '27', '19'], '18675': ['1', '14', '2'], '18795': ['0', '0', '0']}}
2025-08-14 14:05:28,612 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 14:05:28,616 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:05:28,618 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History'}
2025-08-14 14:05:29,129 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_to_write': 52}
2025-08-14 14:05:29,302 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'updated_cells': 364}
2025-08-14 14:05:29,802 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History'}
2025-08-14 14:05:29,803 INFO __main__ --- Daily Shipment Processor finished successfully! ---
2025-08-14 14:09:13,910 INFO settings SERVICE_ACCOUNT_KEY_PATH is set to: C:\Users\NathanNeely\Projects\config\ora-automation-project-dev-25acb5551197.json
2025-08-14 14:09:13,910 INFO settings File exists: True
2025-08-14 14:09:13,911 INFO settings First 100 chars of key file: {
  "type": "service_account",
  "project_id": "ora-automation-project-dev",
  "private_key_id": "64
2025-08-14 14:09:14,297 INFO __main__ --- Starting Daily Shipment Processor ---
2025-08-14 14:09:14,297 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Key from Secret Manager...
2025-08-14 14:09:14,597 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-key'.
2025-08-14 14:09:14,597 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Secret from Secret Manager...
2025-08-14 14:09:14,840 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-secret'.
2025-08-14 14:09:14,841 INFO __main__ Using rolling 32-day date range: 2025-07-13 to 2025-08-14
2025-08-14 14:09:14,841 INFO src.services.shipstation.api_client Starting raw shipment fetch from 2025-07-13 with includeShipmentItems=true and status='shipped'...
2025-08-14 14:09:14,842 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 14:09:15,529 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 14:09:15,538 INFO src.services.shipstation.api_client Fetched page 1 of 2. Total shipments so far: 500
2025-08-14 14:09:15,540 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 14:09:16,022 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 14:09:16,024 INFO src.services.shipstation.api_client Fetched page 2 of 2. Total shipments so far: 705
2025-08-14 14:09:16,025 INFO src.services.shipstation.api_client Finished fetching ShipStation shipments. Total retrieved: 705
2025-08-14 14:09:16,025 INFO __main__ Processing 704 non-voided shipments.
2025-08-14 14:09:16,026 INFO __main__ Processing data for Shipped_Items_Data tab...
2025-08-14 14:09:16,026 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Items_Data tab...
2025-08-14 14:09:16,031 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 704 rows.
2025-08-14 14:09:16,032 INFO __main__ Processing data for Shipped_Orders_Data tab...
2025-08-14 14:09:16,032 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Orders_Data tab...
2025-08-14 14:09:16,039 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 649 unique order rows.
2025-08-14 14:09:16,039 INFO __main__ Overwriting 'Shipped_Items_Data' tab with 704 rows...
2025-08-14 14:09:16,039 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'SKU - Lot': 'object', 'Quantity Shipped': 'int64', 'Base SKU': 'object'}}
2025-08-14 14:09:16,041 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'SKU - Lot': ['17612 - 250195', '17612 - 250195', '17612 - 250195'], 'Quantity Shipped': [6, 2, 6], 'Base SKU': ['17612', '17612', '17612']}}
2025-08-14 14:09:16,043 DEBUG src.services.google_sheets.api_client {'message': 'Attempting to retrieve Google Sheets service account key from Secret Manager.'}
2025-08-14 14:09:16,299 INFO src.services.gcp.secret_manager Successfully accessed secret 'google-sheets-service-account-key'.
2025-08-14 14:09:16,301 INFO src.services.google_sheets.api_client {'message': 'Google Sheets credentials successfully retrieved and cached.'}
2025-08-14 14:09:16,304 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:09:16,307 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 14:09:17,217 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'rows_to_write': 705}
2025-08-14 14:09:17,520 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'updated_cells': 2820}
2025-08-14 14:09:18,059 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 14:09:18,060 INFO __main__ Overwriting 'Shipped_Orders_Data' tab with 649 rows...
2025-08-14 14:09:18,060 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'OrderNumber': 'object'}}
2025-08-14 14:09:18,061 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'OrderNumber': ['669495', '669455', '669445']}}
2025-08-14 14:09:18,063 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 14:09:18,065 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:09:18,071 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 14:09:18,561 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'rows_to_write': 650}
2025-08-14 14:09:18,771 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'updated_cells': 1300}
2025-08-14 14:09:19,257 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 14:09:19,258 INFO __main__ Fetching existing 52-week history for update...
2025-08-14 14:09:19,258 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 14:09:19,260 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:09:19,265 DEBUG src.services.google_sheets.api_client {'message': 'Fetching data from Google Sheet', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'range': "'ORA_Weekly_Shipped_History'!A:ZZ"}
2025-08-14 14:09:19,736 INFO src.services.google_sheets.api_client {'message': 'Successfully retrieved data from Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_count': 52}
2025-08-14 14:09:19,738 CRITICAL __main__ An unhandled error occurred in the daily shipment processor: cannot access local variable 'current_week_items_df' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\daily_shipment_processor.py", line 257, in run_daily_shipment_pull
    updated_history_df = update_weekly_history_incrementally(items_df.copy(), existing_history_df.copy(), target_skus)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\daily_shipment_processor.py", line 48, in update_weekly_history_incrementally
    logger.info(f"Full current_week_items_df for current week:\n{current_week_items_df}")
                                                                 ^^^^^^^^^^^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'current_week_items_df' where it is not associated with a value
2025-08-14 14:15:54,857 INFO settings SERVICE_ACCOUNT_KEY_PATH is set to: C:\Users\NathanNeely\Projects\config\ora-automation-project-dev-25acb5551197.json
2025-08-14 14:15:54,857 INFO settings File exists: True
2025-08-14 14:15:54,857 INFO settings First 100 chars of key file: {
  "type": "service_account",
  "project_id": "ora-automation-project-dev",
  "private_key_id": "64
2025-08-14 14:15:55,184 INFO __main__ --- Starting Daily Shipment Processor ---
2025-08-14 14:15:55,184 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Key from Secret Manager...
2025-08-14 14:15:55,499 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-key'.
2025-08-14 14:15:55,500 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Secret from Secret Manager...
2025-08-14 14:15:55,747 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-secret'.
2025-08-14 14:15:55,748 INFO __main__ Using rolling 32-day date range: 2025-07-13 to 2025-08-14
2025-08-14 14:15:55,748 INFO src.services.shipstation.api_client Starting raw shipment fetch from 2025-07-13 with includeShipmentItems=true and status='shipped'...
2025-08-14 14:15:55,748 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 14:15:56,405 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 14:15:56,414 INFO src.services.shipstation.api_client Fetched page 1 of 2. Total shipments so far: 500
2025-08-14 14:15:56,414 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 14:15:56,924 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 14:15:56,929 INFO src.services.shipstation.api_client Fetched page 2 of 2. Total shipments so far: 705
2025-08-14 14:15:56,929 INFO src.services.shipstation.api_client Finished fetching ShipStation shipments. Total retrieved: 705
2025-08-14 14:15:56,930 INFO __main__ Processing 704 non-voided shipments.
2025-08-14 14:15:56,931 INFO __main__ Processing data for Shipped_Items_Data tab...
2025-08-14 14:15:56,932 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Items_Data tab...
2025-08-14 14:15:56,941 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 704 rows.
2025-08-14 14:15:56,942 INFO __main__ Processing data for Shipped_Orders_Data tab...
2025-08-14 14:15:56,942 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Orders_Data tab...
2025-08-14 14:15:56,952 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 649 unique order rows.
2025-08-14 14:15:56,952 INFO __main__ Overwriting 'Shipped_Items_Data' tab with 704 rows...
2025-08-14 14:15:56,954 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'SKU - Lot': 'object', 'Quantity Shipped': 'int64', 'Base SKU': 'object'}}
2025-08-14 14:15:56,958 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'SKU - Lot': ['17612 - 250195', '17612 - 250195', '17612 - 250195'], 'Quantity Shipped': [6, 2, 6], 'Base SKU': ['17612', '17612', '17612']}}
2025-08-14 14:15:56,961 DEBUG src.services.google_sheets.api_client {'message': 'Attempting to retrieve Google Sheets service account key from Secret Manager.'}
2025-08-14 14:15:57,227 INFO src.services.gcp.secret_manager Successfully accessed secret 'google-sheets-service-account-key'.
2025-08-14 14:15:57,228 INFO src.services.google_sheets.api_client {'message': 'Google Sheets credentials successfully retrieved and cached.'}
2025-08-14 14:15:57,230 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:15:57,233 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 14:15:58,112 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'rows_to_write': 705}
2025-08-14 14:15:58,404 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'updated_cells': 2820}
2025-08-14 14:15:58,955 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 14:15:58,955 INFO __main__ Overwriting 'Shipped_Orders_Data' tab with 649 rows...
2025-08-14 14:15:58,956 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'OrderNumber': 'object'}}
2025-08-14 14:15:58,957 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'OrderNumber': ['669495', '669455', '669445']}}
2025-08-14 14:15:58,959 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 14:15:58,961 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:15:58,965 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 14:15:59,471 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'rows_to_write': 650}
2025-08-14 14:15:59,668 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'updated_cells': 1300}
2025-08-14 14:16:00,139 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 14:16:00,140 INFO __main__ Fetching existing 52-week history for update...
2025-08-14 14:16:00,140 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 14:16:00,142 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:16:00,147 DEBUG src.services.google_sheets.api_client {'message': 'Fetching data from Google Sheet', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'range': "'ORA_Weekly_Shipped_History'!A:ZZ"}
2025-08-14 14:16:00,703 INFO src.services.google_sheets.api_client {'message': 'Successfully retrieved data from Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_count': 52}
2025-08-14 14:16:00,721 INFO __main__ Full current_week_items_df for current week:
      Ship Date  ... Base SKU
595  2025-08-11  ...    17612
596  2025-08-11  ...    17904
597  2025-08-11  ...    17612
598  2025-08-11  ...    17612
599  2025-08-11  ...    17914
..          ...  ...      ...
699  2025-08-14  ...    17612
700  2025-08-14  ...    17612
701  2025-08-14  ...    17904
702  2025-08-14  ...    18795
703  2025-08-14  ...    18795

[109 rows x 4 columns]
2025-08-14 14:16:00,722 INFO __main__ current_week_items_df shape: (109, 4)
2025-08-14 14:16:00,728 INFO __main__ current_week_items_df head:
      Ship Date  ... Base SKU
595  2025-08-11  ...    17612
596  2025-08-11  ...    17904
597  2025-08-11  ...    17612
598  2025-08-11  ...    17612
599  2025-08-11  ...    17914
600  2025-08-11  ...    17612
601  2025-08-11  ...    17612
602  2025-08-11  ...    17612
603  2025-08-11  ...    17612
604  2025-08-11  ...    17904

[10 rows x 4 columns]
2025-08-14 14:16:00,728 INFO __main__ Unique 'Base SKU' values in current_week_items_df: ['17612', '17904', '17914', '18675', '18795']
2025-08-14 14:16:00,728 INFO __main__ Starting incremental update of the 52-week history tab...
2025-08-14 14:16:00,731 INFO __main__ Current week starts on: 2025-08-11
2025-08-14 14:16:00,731 INFO __main__ Unique Ship Dates in daily_items_df: [datetime.date(2025, 7, 14), datetime.date(2025, 7, 15), datetime.date(2025, 7, 16), datetime.date(2025, 7, 17), datetime.date(2025, 7, 18), datetime.date(2025, 7, 21), datetime.date(2025, 7, 22), datetime.date(2025, 7, 23), datetime.date(2025, 7, 24), datetime.date(2025, 7, 25), datetime.date(2025, 7, 28), datetime.date(2025, 7, 29), datetime.date(2025, 7, 30), datetime.date(2025, 7, 31), datetime.date(2025, 8, 1), datetime.date(2025, 8, 4), datetime.date(2025, 8, 5), datetime.date(2025, 8, 6), datetime.date(2025, 8, 7), datetime.date(2025, 8, 8), datetime.date(2025, 8, 11), datetime.date(2025, 8, 12), datetime.date(2025, 8, 13), datetime.date(2025, 8, 14)]
2025-08-14 14:16:00,732 INFO __main__ Min Ship Date: 2025-07-14, Max Ship Date: 2025-08-14
2025-08-14 14:16:00,733 INFO __main__ current_week_items_df shape: (109, 4)
2025-08-14 14:16:00,740 INFO __main__ current_week_items_df head:
      Ship Date  ... Base SKU
595  2025-08-11  ...    17612
596  2025-08-11  ...    17904
597  2025-08-11  ...    17612
598  2025-08-11  ...    17612
599  2025-08-11  ...    17914
600  2025-08-11  ...    17612
601  2025-08-11  ...    17612
602  2025-08-11  ...    17612
603  2025-08-11  ...    17612
604  2025-08-11  ...    17904

[10 rows x 4 columns]
2025-08-14 14:16:00,741 INFO __main__ Unique 'Base SKU' values in current_week_items_df: ['17612', '17904', '17914', '18675', '18795']
2025-08-14 14:16:00,741 INFO __main__ Current week starts on: 2025-08-11
2025-08-14 14:16:00,749 INFO src.services.data_processing.shipment_processor Aggregating weekly shipment history for SKUs: ['17612', '17904', '17914', '18675', '18795']...
2025-08-14 14:16:00,749 WARNING src.services.data_processing.shipment_processor No data found for target SKUs within the raw shipment data.
2025-08-14 14:16:00,751 WARNING __main__ Aggregation of current week's data resulted in an empty DataFrame.
2025-08-14 14:16:00,751 INFO __main__ Overwriting 'ORA_Weekly_Shipped_History' with updated 52-week history...
2025-08-14 14:16:00,752 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Start Date': 'object', 'Stop Date': 'object', '17612': 'object', '17904': 'object', '17914': 'object', '18675': 'object', '18795': 'object'}}
2025-08-14 14:16:00,753 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Start Date': ['2024-08-19', '2024-08-26', '2024-09-02'], 'Stop Date': ['2024-08-25', '2024-09-01', '2024-09-08'], '17612': ['454', '592', '406'], '17904': ['8', '11', '0'], '17914': ['18', '27', '19'], '18675': ['1', '14', '2'], '18795': ['0', '0', '0']}}
2025-08-14 14:16:00,755 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 14:16:00,759 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:16:00,783 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History'}
2025-08-14 14:16:01,281 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_to_write': 52}
2025-08-14 14:16:01,504 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'updated_cells': 364}
2025-08-14 14:16:01,998 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History'}
2025-08-14 14:16:01,998 INFO __main__ --- Daily Shipment Processor finished successfully! ---
2025-08-14 14:24:25,046 INFO settings SERVICE_ACCOUNT_KEY_PATH is set to: C:\Users\NathanNeely\Projects\config\ora-automation-project-dev-25acb5551197.json
2025-08-14 14:24:25,046 INFO settings File exists: True
2025-08-14 14:24:25,049 INFO settings First 100 chars of key file: {
  "type": "service_account",
  "project_id": "ora-automation-project-dev",
  "private_key_id": "64
2025-08-14 14:24:25,403 INFO __main__ --- Starting Daily Shipment Processor ---
2025-08-14 14:24:25,403 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Key from Secret Manager...
2025-08-14 14:24:25,735 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-key'.
2025-08-14 14:24:25,736 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Secret from Secret Manager...
2025-08-14 14:24:26,019 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-secret'.
2025-08-14 14:24:26,020 INFO __main__ Using rolling 32-day date range: 2025-07-13 to 2025-08-14
2025-08-14 14:24:26,020 INFO src.services.shipstation.api_client Starting raw shipment fetch from 2025-07-13 with includeShipmentItems=true and status='shipped'...
2025-08-14 14:24:26,021 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 14:24:26,751 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 14:24:26,758 INFO src.services.shipstation.api_client Fetched page 1 of 2. Total shipments so far: 500
2025-08-14 14:24:26,759 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 14:24:27,255 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 14:24:27,260 INFO src.services.shipstation.api_client Fetched page 2 of 2. Total shipments so far: 705
2025-08-14 14:24:27,261 INFO src.services.shipstation.api_client Finished fetching ShipStation shipments. Total retrieved: 705
2025-08-14 14:24:27,262 INFO __main__ Processing 704 non-voided shipments.
2025-08-14 14:24:27,262 INFO __main__ Processing data for Shipped_Items_Data tab...
2025-08-14 14:24:27,262 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Items_Data tab...
2025-08-14 14:24:27,267 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 704 rows.
2025-08-14 14:24:27,267 INFO __main__ Processing data for Shipped_Orders_Data tab...
2025-08-14 14:24:27,269 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Orders_Data tab...
2025-08-14 14:24:27,275 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 649 unique order rows.
2025-08-14 14:24:27,275 INFO __main__ Overwriting 'Shipped_Items_Data' tab with 704 rows...
2025-08-14 14:24:27,276 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'SKU - Lot': 'object', 'Quantity Shipped': 'int64', 'Base SKU': 'object'}}
2025-08-14 14:24:27,278 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'SKU - Lot': ['17612 - 250195', '17612 - 250195', '17612 - 250195'], 'Quantity Shipped': [6, 2, 6], 'Base SKU': ['17612', '17612', '17612']}}
2025-08-14 14:24:27,281 DEBUG src.services.google_sheets.api_client {'message': 'Attempting to retrieve Google Sheets service account key from Secret Manager.'}
2025-08-14 14:24:27,558 INFO src.services.gcp.secret_manager Successfully accessed secret 'google-sheets-service-account-key'.
2025-08-14 14:24:27,560 INFO src.services.google_sheets.api_client {'message': 'Google Sheets credentials successfully retrieved and cached.'}
2025-08-14 14:24:27,567 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:24:27,573 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 14:24:28,588 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'rows_to_write': 705}
2025-08-14 14:24:28,862 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'updated_cells': 2820}
2025-08-14 14:24:29,409 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 14:24:29,410 INFO __main__ Overwriting 'Shipped_Orders_Data' tab with 649 rows...
2025-08-14 14:24:29,412 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'OrderNumber': 'object'}}
2025-08-14 14:24:29,413 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'OrderNumber': ['669495', '669455', '669445']}}
2025-08-14 14:24:29,414 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 14:24:29,418 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:24:29,421 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 14:24:29,856 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'rows_to_write': 650}
2025-08-14 14:24:30,132 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'updated_cells': 1300}
2025-08-14 14:24:30,753 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 14:24:30,753 INFO __main__ Fetching existing 52-week history for update...
2025-08-14 14:24:30,755 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 14:24:30,756 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:24:30,764 DEBUG src.services.google_sheets.api_client {'message': 'Fetching data from Google Sheet', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'range': "'ORA_Weekly_Shipped_History'!A:ZZ"}
2025-08-14 14:24:31,173 INFO src.services.google_sheets.api_client {'message': 'Successfully retrieved data from Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_count': 52}
2025-08-14 14:24:31,186 INFO __main__ Full current_week_items_df for current week:
      Ship Date  ... Base SKU
595  2025-08-11  ...    17612
596  2025-08-11  ...    17904
597  2025-08-11  ...    17612
598  2025-08-11  ...    17612
599  2025-08-11  ...    17914
..          ...  ...      ...
699  2025-08-14  ...    17612
700  2025-08-14  ...    17612
701  2025-08-14  ...    17904
702  2025-08-14  ...    18795
703  2025-08-14  ...    18795

[109 rows x 4 columns]
2025-08-14 14:24:31,186 INFO __main__ current_week_items_df shape: (109, 4)
2025-08-14 14:24:31,192 INFO __main__ current_week_items_df head:
      Ship Date  ... Base SKU
595  2025-08-11  ...    17612
596  2025-08-11  ...    17904
597  2025-08-11  ...    17612
598  2025-08-11  ...    17612
599  2025-08-11  ...    17914
600  2025-08-11  ...    17612
601  2025-08-11  ...    17612
602  2025-08-11  ...    17612
603  2025-08-11  ...    17612
604  2025-08-11  ...    17904

[10 rows x 4 columns]
2025-08-14 14:24:31,193 INFO __main__ Unique 'Base SKU' values in current_week_items_df: ['17612', '17904', '17914', '18675', '18795']
2025-08-14 14:24:31,193 INFO __main__ Starting incremental update of the 52-week history tab...
2025-08-14 14:24:31,194 INFO __main__ Current week starts on: 2025-08-11
2025-08-14 14:24:31,195 INFO __main__ Unique Ship Dates in daily_items_df: [datetime.date(2025, 7, 14), datetime.date(2025, 7, 15), datetime.date(2025, 7, 16), datetime.date(2025, 7, 17), datetime.date(2025, 7, 18), datetime.date(2025, 7, 21), datetime.date(2025, 7, 22), datetime.date(2025, 7, 23), datetime.date(2025, 7, 24), datetime.date(2025, 7, 25), datetime.date(2025, 7, 28), datetime.date(2025, 7, 29), datetime.date(2025, 7, 30), datetime.date(2025, 7, 31), datetime.date(2025, 8, 1), datetime.date(2025, 8, 4), datetime.date(2025, 8, 5), datetime.date(2025, 8, 6), datetime.date(2025, 8, 7), datetime.date(2025, 8, 8), datetime.date(2025, 8, 11), datetime.date(2025, 8, 12), datetime.date(2025, 8, 13), datetime.date(2025, 8, 14)]
2025-08-14 14:24:31,195 INFO __main__ Min Ship Date: 2025-07-14, Max Ship Date: 2025-08-14
2025-08-14 14:24:31,196 INFO __main__ current_week_items_df shape: (109, 4)
2025-08-14 14:24:31,200 INFO __main__ current_week_items_df head:
      Ship Date  ... Base SKU
595  2025-08-11  ...    17612
596  2025-08-11  ...    17904
597  2025-08-11  ...    17612
598  2025-08-11  ...    17612
599  2025-08-11  ...    17914
600  2025-08-11  ...    17612
601  2025-08-11  ...    17612
602  2025-08-11  ...    17612
603  2025-08-11  ...    17612
604  2025-08-11  ...    17904

[10 rows x 4 columns]
2025-08-14 14:24:31,201 INFO __main__ Unique 'Base SKU' values in current_week_items_df: ['17612', '17904', '17914', '18675', '18795']
2025-08-14 14:24:31,201 INFO __main__ Current week starts on: 2025-08-11
2025-08-14 14:24:31,204 INFO src.services.data_processing.shipment_processor Aggregating weekly shipment history for SKUs: ['17612', '17904', '17914', '18675', '18795']...
2025-08-14 14:24:31,205 WARNING src.services.data_processing.shipment_processor No data found for target SKUs within the raw shipment data.
2025-08-14 14:24:31,205 WARNING __main__ Aggregation of current week's data resulted in an empty DataFrame.
2025-08-14 14:24:31,205 INFO __main__ Overwriting 'ORA_Weekly_Shipped_History' with updated 52-week history...
2025-08-14 14:24:31,206 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Start Date': 'object', 'Stop Date': 'object', '17612': 'object', '17904': 'object', '17914': 'object', '18675': 'object', '18795': 'object'}}
2025-08-14 14:24:31,207 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Start Date': ['2024-08-19', '2024-08-26', '2024-09-02'], 'Stop Date': ['2024-08-25', '2024-09-01', '2024-09-08'], '17612': ['454', '592', '406'], '17904': ['8', '11', '0'], '17914': ['18', '27', '19'], '18675': ['1', '14', '2'], '18795': ['0', '0', '0']}}
2025-08-14 14:24:31,207 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 14:24:31,209 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:24:31,222 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History'}
2025-08-14 14:24:31,620 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_to_write': 52}
2025-08-14 14:24:31,789 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'updated_cells': 364}
2025-08-14 14:24:32,303 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History'}
2025-08-14 14:24:32,303 INFO __main__ --- Daily Shipment Processor finished successfully! ---
2025-08-14 14:28:13,405 INFO settings SERVICE_ACCOUNT_KEY_PATH is set to: C:\Users\NathanNeely\Projects\config\ora-automation-project-dev-25acb5551197.json
2025-08-14 14:28:13,406 INFO settings File exists: True
2025-08-14 14:28:13,406 INFO settings First 100 chars of key file: {
  "type": "service_account",
  "project_id": "ora-automation-project-dev",
  "private_key_id": "64
2025-08-14 14:28:13,745 INFO __main__ --- Starting Daily Shipment Processor ---
2025-08-14 14:28:13,745 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Key from Secret Manager...
2025-08-14 14:28:14,069 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-key'.
2025-08-14 14:28:14,070 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Secret from Secret Manager...
2025-08-14 14:28:14,333 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-secret'.
2025-08-14 14:28:14,333 INFO __main__ Using rolling 32-day date range: 2025-07-13 to 2025-08-14
2025-08-14 14:28:14,333 INFO src.services.shipstation.api_client Starting raw shipment fetch from 2025-07-13 with includeShipmentItems=true and status='shipped'...
2025-08-14 14:28:14,333 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 14:28:15,029 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 14:28:15,036 INFO src.services.shipstation.api_client Fetched page 1 of 2. Total shipments so far: 500
2025-08-14 14:28:15,036 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 14:28:15,612 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 14:28:15,615 INFO src.services.shipstation.api_client Fetched page 2 of 2. Total shipments so far: 705
2025-08-14 14:28:15,615 INFO src.services.shipstation.api_client Finished fetching ShipStation shipments. Total retrieved: 705
2025-08-14 14:28:15,616 INFO __main__ Processing 704 non-voided shipments.
2025-08-14 14:28:15,616 INFO __main__ Processing data for Shipped_Items_Data tab...
2025-08-14 14:28:15,616 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Items_Data tab...
2025-08-14 14:28:15,621 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 704 rows.
2025-08-14 14:28:15,622 INFO __main__ Processing data for Shipped_Orders_Data tab...
2025-08-14 14:28:15,622 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Orders_Data tab...
2025-08-14 14:28:15,627 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 649 unique order rows.
2025-08-14 14:28:15,627 INFO __main__ Overwriting 'Shipped_Items_Data' tab with 704 rows...
2025-08-14 14:28:15,628 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'SKU - Lot': 'object', 'Quantity Shipped': 'int64', 'Base SKU': 'object'}}
2025-08-14 14:28:15,630 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'SKU - Lot': ['17612 - 250195', '17612 - 250195', '17612 - 250195'], 'Quantity Shipped': [6, 2, 6], 'Base SKU': ['17612', '17612', '17612']}}
2025-08-14 14:28:15,632 DEBUG src.services.google_sheets.api_client {'message': 'Attempting to retrieve Google Sheets service account key from Secret Manager.'}
2025-08-14 14:28:15,919 INFO src.services.gcp.secret_manager Successfully accessed secret 'google-sheets-service-account-key'.
2025-08-14 14:28:15,920 INFO src.services.google_sheets.api_client {'message': 'Google Sheets credentials successfully retrieved and cached.'}
2025-08-14 14:28:15,923 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:28:15,925 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 14:28:16,701 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'rows_to_write': 705}
2025-08-14 14:28:17,015 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'updated_cells': 2820}
2025-08-14 14:28:17,563 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 14:28:17,563 INFO __main__ Overwriting 'Shipped_Orders_Data' tab with 649 rows...
2025-08-14 14:28:17,563 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'OrderNumber': 'object'}}
2025-08-14 14:28:17,565 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'OrderNumber': ['669495', '669455', '669445']}}
2025-08-14 14:28:17,566 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 14:28:17,567 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:28:17,571 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 14:28:18,065 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'rows_to_write': 650}
2025-08-14 14:28:18,294 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'updated_cells': 1300}
2025-08-14 14:28:18,778 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 14:28:18,779 INFO __main__ Fetching existing 52-week history for update...
2025-08-14 14:28:18,779 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 14:28:18,782 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:28:18,785 DEBUG src.services.google_sheets.api_client {'message': 'Fetching data from Google Sheet', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'range': "'ORA_Weekly_Shipped_History'!A:ZZ"}
2025-08-14 14:28:19,220 INFO src.services.google_sheets.api_client {'message': 'Successfully retrieved data from Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_count': 52}
2025-08-14 14:28:19,245 INFO __main__ Full current_week_items_df for current week:
      Ship Date       SKU - Lot  Quantity Shipped Base SKU
595  2025-08-11  17612 - 250216                 7    17612
596  2025-08-11  17904 - 240276                 1    17904
597  2025-08-11  17612 - 250216                 1    17612
598  2025-08-11  17612 - 250216                 1    17612
599  2025-08-11  17914 - 240286                 6    17914
..          ...             ...               ...      ...
699  2025-08-14  17612 - 250216                 6    17612
700  2025-08-14  17612 - 250216                 6    17612
701  2025-08-14  17904 - 240276                 2    17904
702  2025-08-14   18795 - 11001                 1    18795
703  2025-08-14   18795 - 11001                 1    18795

[109 rows x 4 columns]
2025-08-14 14:28:19,247 INFO __main__ current_week_items_df shape: (109, 4)
2025-08-14 14:28:19,262 INFO __main__ current_week_items_df head:
      Ship Date       SKU - Lot  Quantity Shipped Base SKU
595  2025-08-11  17612 - 250216                 7    17612
596  2025-08-11  17904 - 240276                 1    17904
597  2025-08-11  17612 - 250216                 1    17612
598  2025-08-11  17612 - 250216                 1    17612
599  2025-08-11  17914 - 240286                 6    17914
600  2025-08-11  17612 - 250216                 6    17612
601  2025-08-11  17612 - 250216                 2    17612
602  2025-08-11  17612 - 250216                 2    17612
603  2025-08-11  17612 - 250216                 1    17612
604  2025-08-11  17904 - 240276                 1    17904
2025-08-14 14:28:19,264 INFO __main__ Unique 'Base SKU' values in current_week_items_df: ['17612', '17904', '17914', '18675', '18795']
2025-08-14 14:28:19,264 INFO __main__ Starting incremental update of the 52-week history tab...
2025-08-14 14:28:19,268 INFO __main__ Current week starts on: 2025-08-11
2025-08-14 14:28:19,269 INFO __main__ Unique Ship Dates in daily_items_df: [datetime.date(2025, 7, 14), datetime.date(2025, 7, 15), datetime.date(2025, 7, 16), datetime.date(2025, 7, 17), datetime.date(2025, 7, 18), datetime.date(2025, 7, 21), datetime.date(2025, 7, 22), datetime.date(2025, 7, 23), datetime.date(2025, 7, 24), datetime.date(2025, 7, 25), datetime.date(2025, 7, 28), datetime.date(2025, 7, 29), datetime.date(2025, 7, 30), datetime.date(2025, 7, 31), datetime.date(2025, 8, 1), datetime.date(2025, 8, 4), datetime.date(2025, 8, 5), datetime.date(2025, 8, 6), datetime.date(2025, 8, 7), datetime.date(2025, 8, 8), datetime.date(2025, 8, 11), datetime.date(2025, 8, 12), datetime.date(2025, 8, 13), datetime.date(2025, 8, 14)]
2025-08-14 14:28:19,270 INFO __main__ Min Ship Date: 2025-07-14, Max Ship Date: 2025-08-14
2025-08-14 14:28:19,272 INFO __main__ current_week_items_df shape: (109, 4)
2025-08-14 14:28:19,281 INFO __main__ current_week_items_df head:
      Ship Date       SKU - Lot  Quantity Shipped Base SKU
595  2025-08-11  17612 - 250216                 7    17612
596  2025-08-11  17904 - 240276                 1    17904
597  2025-08-11  17612 - 250216                 1    17612
598  2025-08-11  17612 - 250216                 1    17612
599  2025-08-11  17914 - 240286                 6    17914
600  2025-08-11  17612 - 250216                 6    17612
601  2025-08-11  17612 - 250216                 2    17612
602  2025-08-11  17612 - 250216                 2    17612
603  2025-08-11  17612 - 250216                 1    17612
604  2025-08-11  17904 - 240276                 1    17904
2025-08-14 14:28:19,282 INFO __main__ Unique 'Base SKU' values in current_week_items_df: ['17612', '17904', '17914', '18675', '18795']
2025-08-14 14:28:19,282 INFO __main__ Current week starts on: 2025-08-11
2025-08-14 14:28:19,289 INFO src.services.data_processing.shipment_processor Aggregating weekly shipment history for SKUs: ['17612', '17904', '17914', '18675', '18795']...
2025-08-14 14:28:19,289 WARNING src.services.data_processing.shipment_processor No data found for target SKUs within the raw shipment data.
2025-08-14 14:28:19,292 WARNING __main__ Aggregation of current week's data resulted in an empty DataFrame.
2025-08-14 14:28:19,293 INFO __main__ Overwriting 'ORA_Weekly_Shipped_History' with updated 52-week history...
2025-08-14 14:28:19,294 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Start Date': 'object', 'Stop Date': 'object', '17612': 'object', '17904': 'object', '17914': 'object', '18675': 'object', '18795': 'object'}}
2025-08-14 14:28:19,296 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Start Date': ['2024-08-19', '2024-08-26', '2024-09-02'], 'Stop Date': ['2024-08-25', '2024-09-01', '2024-09-08'], '17612': ['454', '592', '406'], '17904': ['8', '11', '0'], '17914': ['18', '27', '19'], '18675': ['1', '14', '2'], '18795': ['0', '0', '0']}}
2025-08-14 14:28:19,298 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 14:28:19,300 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:28:19,325 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History'}
2025-08-14 14:28:19,890 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_to_write': 52}
2025-08-14 14:28:20,065 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'updated_cells': 364}
2025-08-14 14:28:20,547 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History'}
2025-08-14 14:28:20,549 INFO __main__ --- Daily Shipment Processor finished successfully! ---
2025-08-14 14:33:35,503 INFO settings SERVICE_ACCOUNT_KEY_PATH is set to: C:\Users\NathanNeely\Projects\config\ora-automation-project-dev-25acb5551197.json
2025-08-14 14:33:35,504 INFO settings File exists: True
2025-08-14 14:33:35,504 INFO settings First 100 chars of key file: {
  "type": "service_account",
  "project_id": "ora-automation-project-dev",
  "private_key_id": "64
2025-08-14 14:33:35,889 INFO __main__ --- Starting Daily Shipment Processor ---
2025-08-14 14:33:35,889 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Key from Secret Manager...
2025-08-14 14:33:36,200 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-key'.
2025-08-14 14:33:36,202 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Secret from Secret Manager...
2025-08-14 14:33:36,521 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-secret'.
2025-08-14 14:33:36,521 INFO __main__ Using rolling 32-day date range: 2025-07-13 to 2025-08-14
2025-08-14 14:33:36,521 INFO src.services.shipstation.api_client Starting raw shipment fetch from 2025-07-13 with includeShipmentItems=true and status='shipped'...
2025-08-14 14:33:36,522 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 14:33:37,292 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 14:33:37,300 INFO src.services.shipstation.api_client Fetched page 1 of 2. Total shipments so far: 500
2025-08-14 14:33:37,300 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 14:33:37,805 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 14:33:37,807 INFO src.services.shipstation.api_client Fetched page 2 of 2. Total shipments so far: 705
2025-08-14 14:33:37,807 INFO src.services.shipstation.api_client Finished fetching ShipStation shipments. Total retrieved: 705
2025-08-14 14:33:37,807 INFO __main__ Processing 704 non-voided shipments.
2025-08-14 14:33:37,808 INFO __main__ Processing data for Shipped_Items_Data tab...
2025-08-14 14:33:37,808 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Items_Data tab...
2025-08-14 14:33:37,813 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 704 rows.
2025-08-14 14:33:37,815 INFO __main__ Processing data for Shipped_Orders_Data tab...
2025-08-14 14:33:37,815 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Orders_Data tab...
2025-08-14 14:33:37,820 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 649 unique order rows.
2025-08-14 14:33:37,820 INFO __main__ Overwriting 'Shipped_Items_Data' tab with 704 rows...
2025-08-14 14:33:37,821 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'SKU - Lot': 'object', 'Quantity Shipped': 'int64', 'Base SKU': 'object'}}
2025-08-14 14:33:37,823 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'SKU - Lot': ['17612 - 250195', '17612 - 250195', '17612 - 250195'], 'Quantity Shipped': [6, 2, 6], 'Base SKU': ['17612', '17612', '17612']}}
2025-08-14 14:33:37,824 DEBUG src.services.google_sheets.api_client {'message': 'Attempting to retrieve Google Sheets service account key from Secret Manager.'}
2025-08-14 14:33:38,297 INFO src.services.gcp.secret_manager Successfully accessed secret 'google-sheets-service-account-key'.
2025-08-14 14:33:38,298 INFO src.services.google_sheets.api_client {'message': 'Google Sheets credentials successfully retrieved and cached.'}
2025-08-14 14:33:38,301 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:33:38,303 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 14:33:39,129 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'rows_to_write': 705}
2025-08-14 14:33:39,398 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'updated_cells': 2820}
2025-08-14 14:33:40,085 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 14:33:40,085 INFO __main__ Overwriting 'Shipped_Orders_Data' tab with 649 rows...
2025-08-14 14:33:40,086 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'OrderNumber': 'object'}}
2025-08-14 14:33:40,086 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'OrderNumber': ['669495', '669455', '669445']}}
2025-08-14 14:33:40,087 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 14:33:40,089 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:33:40,093 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 14:33:40,608 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'rows_to_write': 650}
2025-08-14 14:33:40,813 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'updated_cells': 1300}
2025-08-14 14:33:41,280 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 14:33:41,281 INFO __main__ Fetching existing 52-week history for update...
2025-08-14 14:33:41,281 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 14:33:41,283 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:33:41,289 DEBUG src.services.google_sheets.api_client {'message': 'Fetching data from Google Sheet', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'range': "'ORA_Weekly_Shipped_History'!A:ZZ"}
2025-08-14 14:33:41,886 INFO src.services.google_sheets.api_client {'message': 'Successfully retrieved data from Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_count': 52}
2025-08-14 14:33:41,900 INFO __main__ Full current_week_items_df for current week:
      Ship Date  ... Base SKU
595  2025-08-11  ...    17612
596  2025-08-11  ...    17904
597  2025-08-11  ...    17612
598  2025-08-11  ...    17612
599  2025-08-11  ...    17914
..          ...  ...      ...
699  2025-08-14  ...    17612
700  2025-08-14  ...    17612
701  2025-08-14  ...    17904
702  2025-08-14  ...    18795
703  2025-08-14  ...    18795

[109 rows x 4 columns]
2025-08-14 14:33:41,900 INFO __main__ current_week_items_df shape: (109, 4)
2025-08-14 14:33:41,903 INFO __main__ current_week_items_df head:
      Ship Date  ... Base SKU
595  2025-08-11  ...    17612
596  2025-08-11  ...    17904
597  2025-08-11  ...    17612
598  2025-08-11  ...    17612
599  2025-08-11  ...    17914
600  2025-08-11  ...    17612
601  2025-08-11  ...    17612
602  2025-08-11  ...    17612
603  2025-08-11  ...    17612
604  2025-08-11  ...    17904

[10 rows x 4 columns]
2025-08-14 14:33:41,903 INFO __main__ Unique 'Base SKU' values in current_week_items_df: ['17612', '17904', '17914', '18675', '18795']
2025-08-14 14:33:41,905 INFO __main__ Starting incremental update of the 52-week history tab...
2025-08-14 14:33:41,906 INFO __main__ Current week starts on: 2025-08-11
2025-08-14 14:33:41,907 INFO __main__ Unique Ship Dates in daily_items_df: [datetime.date(2025, 7, 14), datetime.date(2025, 7, 15), datetime.date(2025, 7, 16), datetime.date(2025, 7, 17), datetime.date(2025, 7, 18), datetime.date(2025, 7, 21), datetime.date(2025, 7, 22), datetime.date(2025, 7, 23), datetime.date(2025, 7, 24), datetime.date(2025, 7, 25), datetime.date(2025, 7, 28), datetime.date(2025, 7, 29), datetime.date(2025, 7, 30), datetime.date(2025, 7, 31), datetime.date(2025, 8, 1), datetime.date(2025, 8, 4), datetime.date(2025, 8, 5), datetime.date(2025, 8, 6), datetime.date(2025, 8, 7), datetime.date(2025, 8, 8), datetime.date(2025, 8, 11), datetime.date(2025, 8, 12), datetime.date(2025, 8, 13), datetime.date(2025, 8, 14)]
2025-08-14 14:33:41,907 INFO __main__ Min Ship Date: 2025-07-14, Max Ship Date: 2025-08-14
2025-08-14 14:33:41,908 INFO __main__ current_week_items_df shape: (109, 4)
2025-08-14 14:33:41,913 INFO __main__ current_week_items_df head:
      Ship Date  ... Base SKU
595  2025-08-11  ...    17612
596  2025-08-11  ...    17904
597  2025-08-11  ...    17612
598  2025-08-11  ...    17612
599  2025-08-11  ...    17914
600  2025-08-11  ...    17612
601  2025-08-11  ...    17612
602  2025-08-11  ...    17612
603  2025-08-11  ...    17612
604  2025-08-11  ...    17904

[10 rows x 4 columns]
2025-08-14 14:33:41,914 INFO __main__ Unique 'Base SKU' values in current_week_items_df: ['17612', '17904', '17914', '18675', '18795']
2025-08-14 14:33:41,914 INFO __main__ Current week starts on: 2025-08-11
2025-08-14 14:33:41,918 CRITICAL __main__ An unhandled error occurred in the daily shipment processor: shipment_data (raw API response) must be available in update_weekly_history_incrementally or passed as an argument.
Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\daily_shipment_processor.py", line 153, in update_weekly_history_incrementally
    shipment_data = globals()['shipment_data']
                    ~~~~~~~~~^^^^^^^^^^^^^^^^^
KeyError: 'shipment_data'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\daily_shipment_processor.py", line 283, in run_daily_shipment_pull
    updated_history_df = update_weekly_history_incrementally(items_df.copy(), existing_history_df.copy(), target_skus)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\daily_shipment_processor.py", line 155, in update_weekly_history_incrementally
    raise RuntimeError("shipment_data (raw API response) must be available in update_weekly_history_incrementally or passed as an argument.")
RuntimeError: shipment_data (raw API response) must be available in update_weekly_history_incrementally or passed as an argument.
2025-08-14 14:34:29,322 INFO settings SERVICE_ACCOUNT_KEY_PATH is set to: C:\Users\NathanNeely\Projects\config\ora-automation-project-dev-25acb5551197.json
2025-08-14 14:34:29,322 INFO settings File exists: True
2025-08-14 14:34:29,323 INFO settings First 100 chars of key file: {
  "type": "service_account",
  "project_id": "ora-automation-project-dev",
  "private_key_id": "64
2025-08-14 14:34:29,664 INFO __main__ --- Starting Daily Shipment Processor ---
2025-08-14 14:34:29,664 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Key from Secret Manager...
2025-08-14 14:34:29,938 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-key'.
2025-08-14 14:34:29,939 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Secret from Secret Manager...
2025-08-14 14:34:30,219 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-secret'.
2025-08-14 14:34:30,219 INFO __main__ Using rolling 32-day date range: 2025-07-13 to 2025-08-14
2025-08-14 14:34:30,219 INFO src.services.shipstation.api_client Starting raw shipment fetch from 2025-07-13 with includeShipmentItems=true and status='shipped'...
2025-08-14 14:34:30,219 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 14:34:30,861 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 14:34:30,868 INFO src.services.shipstation.api_client Fetched page 1 of 2. Total shipments so far: 500
2025-08-14 14:34:30,868 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 14:34:31,366 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 14:34:31,369 INFO src.services.shipstation.api_client Fetched page 2 of 2. Total shipments so far: 705
2025-08-14 14:34:31,370 INFO src.services.shipstation.api_client Finished fetching ShipStation shipments. Total retrieved: 705
2025-08-14 14:34:31,370 INFO __main__ Processing 704 non-voided shipments.
2025-08-14 14:34:31,371 INFO __main__ Processing data for Shipped_Items_Data tab...
2025-08-14 14:34:31,371 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Items_Data tab...
2025-08-14 14:34:31,376 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 704 rows.
2025-08-14 14:34:31,377 INFO __main__ Processing data for Shipped_Orders_Data tab...
2025-08-14 14:34:31,377 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Orders_Data tab...
2025-08-14 14:34:31,382 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 649 unique order rows.
2025-08-14 14:34:31,383 INFO __main__ Overwriting 'Shipped_Items_Data' tab with 704 rows...
2025-08-14 14:34:31,383 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'SKU - Lot': 'object', 'Quantity Shipped': 'int64', 'Base SKU': 'object'}}
2025-08-14 14:34:31,385 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'SKU - Lot': ['17612 - 250195', '17612 - 250195', '17612 - 250195'], 'Quantity Shipped': [6, 2, 6], 'Base SKU': ['17612', '17612', '17612']}}
2025-08-14 14:34:31,387 DEBUG src.services.google_sheets.api_client {'message': 'Attempting to retrieve Google Sheets service account key from Secret Manager.'}
2025-08-14 14:34:31,755 INFO src.services.gcp.secret_manager Successfully accessed secret 'google-sheets-service-account-key'.
2025-08-14 14:34:31,757 INFO src.services.google_sheets.api_client {'message': 'Google Sheets credentials successfully retrieved and cached.'}
2025-08-14 14:34:31,763 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:34:31,767 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 14:34:32,439 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'rows_to_write': 705}
2025-08-14 14:34:32,686 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'updated_cells': 2820}
2025-08-14 14:34:33,361 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 14:34:33,362 INFO __main__ Overwriting 'Shipped_Orders_Data' tab with 649 rows...
2025-08-14 14:34:33,363 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'OrderNumber': 'object'}}
2025-08-14 14:34:33,364 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'OrderNumber': ['669495', '669455', '669445']}}
2025-08-14 14:34:33,367 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 14:34:33,370 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:34:33,377 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 14:34:33,989 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'rows_to_write': 650}
2025-08-14 14:34:34,215 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'updated_cells': 1300}
2025-08-14 14:34:34,739 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 14:34:34,739 INFO __main__ Fetching existing 52-week history for update...
2025-08-14 14:34:34,739 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 14:34:34,743 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:34:34,752 DEBUG src.services.google_sheets.api_client {'message': 'Fetching data from Google Sheet', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'range': "'ORA_Weekly_Shipped_History'!A:ZZ"}
2025-08-14 14:34:35,371 INFO src.services.google_sheets.api_client {'message': 'Successfully retrieved data from Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_count': 52}
2025-08-14 14:34:35,390 INFO __main__ Full current_week_items_df for current week:
      Ship Date  ... Base SKU
595  2025-08-11  ...    17612
596  2025-08-11  ...    17904
597  2025-08-11  ...    17612
598  2025-08-11  ...    17612
599  2025-08-11  ...    17914
..          ...  ...      ...
699  2025-08-14  ...    17612
700  2025-08-14  ...    17612
701  2025-08-14  ...    17904
702  2025-08-14  ...    18795
703  2025-08-14  ...    18795

[109 rows x 4 columns]
2025-08-14 14:34:35,391 INFO __main__ current_week_items_df shape: (109, 4)
2025-08-14 14:34:35,401 INFO __main__ current_week_items_df head:
      Ship Date  ... Base SKU
595  2025-08-11  ...    17612
596  2025-08-11  ...    17904
597  2025-08-11  ...    17612
598  2025-08-11  ...    17612
599  2025-08-11  ...    17914
600  2025-08-11  ...    17612
601  2025-08-11  ...    17612
602  2025-08-11  ...    17612
603  2025-08-11  ...    17612
604  2025-08-11  ...    17904

[10 rows x 4 columns]
2025-08-14 14:34:35,403 INFO __main__ Unique 'Base SKU' values in current_week_items_df: ['17612', '17904', '17914', '18675', '18795']
2025-08-14 14:34:35,403 INFO __main__ Starting incremental update of the 52-week history tab...
2025-08-14 14:34:35,407 INFO __main__ Current week starts on: 2025-08-11
2025-08-14 14:34:35,408 INFO __main__ Unique Ship Dates in daily_items_df: [datetime.date(2025, 7, 14), datetime.date(2025, 7, 15), datetime.date(2025, 7, 16), datetime.date(2025, 7, 17), datetime.date(2025, 7, 18), datetime.date(2025, 7, 21), datetime.date(2025, 7, 22), datetime.date(2025, 7, 23), datetime.date(2025, 7, 24), datetime.date(2025, 7, 25), datetime.date(2025, 7, 28), datetime.date(2025, 7, 29), datetime.date(2025, 7, 30), datetime.date(2025, 7, 31), datetime.date(2025, 8, 1), datetime.date(2025, 8, 4), datetime.date(2025, 8, 5), datetime.date(2025, 8, 6), datetime.date(2025, 8, 7), datetime.date(2025, 8, 8), datetime.date(2025, 8, 11), datetime.date(2025, 8, 12), datetime.date(2025, 8, 13), datetime.date(2025, 8, 14)]
2025-08-14 14:34:35,409 INFO __main__ Min Ship Date: 2025-07-14, Max Ship Date: 2025-08-14
2025-08-14 14:34:35,410 INFO __main__ current_week_items_df shape: (109, 4)
2025-08-14 14:34:35,423 INFO __main__ current_week_items_df head:
      Ship Date  ... Base SKU
595  2025-08-11  ...    17612
596  2025-08-11  ...    17904
597  2025-08-11  ...    17612
598  2025-08-11  ...    17612
599  2025-08-11  ...    17914
600  2025-08-11  ...    17612
601  2025-08-11  ...    17612
602  2025-08-11  ...    17612
603  2025-08-11  ...    17612
604  2025-08-11  ...    17904

[10 rows x 4 columns]
2025-08-14 14:34:35,425 INFO __main__ Unique 'Base SKU' values in current_week_items_df: ['17612', '17904', '17914', '18675', '18795']
2025-08-14 14:34:35,425 INFO __main__ Current week starts on: 2025-08-11
2025-08-14 14:34:35,429 CRITICAL __main__ An unhandled error occurred in the daily shipment processor: shipment_data (raw API response) must be available in update_weekly_history_incrementally or passed as an argument.
Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\daily_shipment_processor.py", line 153, in update_weekly_history_incrementally
    shipment_data = globals()['shipment_data']
                    ~~~~~~~~~^^^^^^^^^^^^^^^^^
KeyError: 'shipment_data'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\daily_shipment_processor.py", line 283, in run_daily_shipment_pull
    updated_history_df = update_weekly_history_incrementally(items_df.copy(), existing_history_df.copy(), target_skus, shipment_data)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\NathanNeely\Projects\ORA_Automation\src\daily_shipment_processor.py", line 155, in update_weekly_history_incrementally
    raise RuntimeError("shipment_data (raw API response) must be available in update_weekly_history_incrementally or passed as an argument.")
RuntimeError: shipment_data (raw API response) must be available in update_weekly_history_incrementally or passed as an argument.
2025-08-14 14:37:01,183 INFO settings SERVICE_ACCOUNT_KEY_PATH is set to: C:\Users\NathanNeely\Projects\config\ora-automation-project-dev-25acb5551197.json
2025-08-14 14:37:01,183 INFO settings File exists: True
2025-08-14 14:37:01,183 INFO settings First 100 chars of key file: {
  "type": "service_account",
  "project_id": "ora-automation-project-dev",
  "private_key_id": "64
2025-08-14 14:37:01,537 INFO __main__ --- Starting Daily Shipment Processor ---
2025-08-14 14:37:01,538 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Key from Secret Manager...
2025-08-14 14:37:01,832 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-key'.
2025-08-14 14:37:01,833 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Secret from Secret Manager...
2025-08-14 14:37:02,096 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-secret'.
2025-08-14 14:37:02,096 INFO __main__ Using rolling 32-day date range: 2025-07-13 to 2025-08-14
2025-08-14 14:37:02,096 INFO src.services.shipstation.api_client Starting raw shipment fetch from 2025-07-13 with includeShipmentItems=true and status='shipped'...
2025-08-14 14:37:02,097 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 14:37:02,854 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 14:37:02,863 INFO src.services.shipstation.api_client Fetched page 1 of 2. Total shipments so far: 500
2025-08-14 14:37:02,865 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 14:37:03,410 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 14:37:03,413 INFO src.services.shipstation.api_client Fetched page 2 of 2. Total shipments so far: 705
2025-08-14 14:37:03,413 INFO src.services.shipstation.api_client Finished fetching ShipStation shipments. Total retrieved: 705
2025-08-14 14:37:03,413 INFO __main__ Processing 704 non-voided shipments.
2025-08-14 14:37:03,413 INFO __main__ Processing data for Shipped_Items_Data tab...
2025-08-14 14:37:03,413 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Items_Data tab...
2025-08-14 14:37:03,419 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 704 rows.
2025-08-14 14:37:03,419 INFO __main__ Processing data for Shipped_Orders_Data tab...
2025-08-14 14:37:03,420 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Orders_Data tab...
2025-08-14 14:37:03,425 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 649 unique order rows.
2025-08-14 14:37:03,425 INFO __main__ Overwriting 'Shipped_Items_Data' tab with 704 rows...
2025-08-14 14:37:03,426 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'SKU - Lot': 'object', 'Quantity Shipped': 'int64', 'Base SKU': 'object'}}
2025-08-14 14:37:03,428 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'SKU - Lot': ['17612 - 250195', '17612 - 250195', '17612 - 250195'], 'Quantity Shipped': [6, 2, 6], 'Base SKU': ['17612', '17612', '17612']}}
2025-08-14 14:37:03,429 DEBUG src.services.google_sheets.api_client {'message': 'Attempting to retrieve Google Sheets service account key from Secret Manager.'}
2025-08-14 14:37:03,673 INFO src.services.gcp.secret_manager Successfully accessed secret 'google-sheets-service-account-key'.
2025-08-14 14:37:03,674 INFO src.services.google_sheets.api_client {'message': 'Google Sheets credentials successfully retrieved and cached.'}
2025-08-14 14:37:03,678 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:37:03,682 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 14:37:04,576 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'rows_to_write': 705}
2025-08-14 14:37:04,850 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'updated_cells': 2820}
2025-08-14 14:37:05,554 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 14:37:05,554 INFO __main__ Overwriting 'Shipped_Orders_Data' tab with 649 rows...
2025-08-14 14:37:05,554 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'OrderNumber': 'object'}}
2025-08-14 14:37:05,555 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'OrderNumber': ['669495', '669455', '669445']}}
2025-08-14 14:37:05,555 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 14:37:05,557 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:37:05,561 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 14:37:05,957 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'rows_to_write': 650}
2025-08-14 14:37:06,206 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'updated_cells': 1300}
2025-08-14 14:37:06,663 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 14:37:06,663 INFO __main__ Fetching existing 52-week history for update...
2025-08-14 14:37:06,664 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 14:37:06,667 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:37:06,677 DEBUG src.services.google_sheets.api_client {'message': 'Fetching data from Google Sheet', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'range': "'ORA_Weekly_Shipped_History'!A:ZZ"}
2025-08-14 14:37:07,068 INFO src.services.google_sheets.api_client {'message': 'Successfully retrieved data from Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_count': 52}
2025-08-14 14:37:07,086 INFO __main__ Full current_week_items_df for current week:
      Ship Date  ... Base SKU
595  2025-08-11  ...    17612
596  2025-08-11  ...    17904
597  2025-08-11  ...    17612
598  2025-08-11  ...    17612
599  2025-08-11  ...    17914
..          ...  ...      ...
699  2025-08-14  ...    17612
700  2025-08-14  ...    17612
701  2025-08-14  ...    17904
702  2025-08-14  ...    18795
703  2025-08-14  ...    18795

[109 rows x 4 columns]
2025-08-14 14:37:07,086 INFO __main__ current_week_items_df shape: (109, 4)
2025-08-14 14:37:07,092 INFO __main__ current_week_items_df head:
      Ship Date  ... Base SKU
595  2025-08-11  ...    17612
596  2025-08-11  ...    17904
597  2025-08-11  ...    17612
598  2025-08-11  ...    17612
599  2025-08-11  ...    17914
600  2025-08-11  ...    17612
601  2025-08-11  ...    17612
602  2025-08-11  ...    17612
603  2025-08-11  ...    17612
604  2025-08-11  ...    17904

[10 rows x 4 columns]
2025-08-14 14:37:07,093 INFO __main__ Unique 'Base SKU' values in current_week_items_df: ['17612', '17904', '17914', '18675', '18795']
2025-08-14 14:37:07,093 INFO __main__ Starting incremental update of the 52-week history tab...
2025-08-14 14:37:07,096 INFO __main__ Current week starts on: 2025-08-11
2025-08-14 14:37:07,097 INFO __main__ Unique Ship Dates in daily_items_df: [datetime.date(2025, 7, 14), datetime.date(2025, 7, 15), datetime.date(2025, 7, 16), datetime.date(2025, 7, 17), datetime.date(2025, 7, 18), datetime.date(2025, 7, 21), datetime.date(2025, 7, 22), datetime.date(2025, 7, 23), datetime.date(2025, 7, 24), datetime.date(2025, 7, 25), datetime.date(2025, 7, 28), datetime.date(2025, 7, 29), datetime.date(2025, 7, 30), datetime.date(2025, 7, 31), datetime.date(2025, 8, 1), datetime.date(2025, 8, 4), datetime.date(2025, 8, 5), datetime.date(2025, 8, 6), datetime.date(2025, 8, 7), datetime.date(2025, 8, 8), datetime.date(2025, 8, 11), datetime.date(2025, 8, 12), datetime.date(2025, 8, 13), datetime.date(2025, 8, 14)]
2025-08-14 14:37:07,097 INFO __main__ Min Ship Date: 2025-07-14, Max Ship Date: 2025-08-14
2025-08-14 14:37:07,098 INFO __main__ current_week_items_df shape: (109, 4)
2025-08-14 14:37:07,101 INFO __main__ current_week_items_df head:
      Ship Date  ... Base SKU
595  2025-08-11  ...    17612
596  2025-08-11  ...    17904
597  2025-08-11  ...    17612
598  2025-08-11  ...    17612
599  2025-08-11  ...    17914
600  2025-08-11  ...    17612
601  2025-08-11  ...    17612
602  2025-08-11  ...    17612
603  2025-08-11  ...    17612
604  2025-08-11  ...    17904

[10 rows x 4 columns]
2025-08-14 14:37:07,101 INFO __main__ Unique 'Base SKU' values in current_week_items_df: ['17612', '17904', '17914', '18675', '18795']
2025-08-14 14:37:07,101 INFO __main__ Current week starts on: 2025-08-11
2025-08-14 14:37:07,107 INFO src.services.data_processing.shipment_processor Aggregating weekly shipment history for SKUs: ['17612', '17904', '17914', '18675', '18795']...
2025-08-14 14:37:07,135 INFO src.services.data_processing.shipment_processor Aggregation complete. Final report has 1 weekly rows.
2025-08-14 14:37:07,151 INFO __main__ Current week found in history. Updating the last row.
2025-08-14 14:37:07,152 INFO __main__ Overwriting 'ORA_Weekly_Shipped_History' with updated 52-week history...
2025-08-14 14:37:07,153 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Start Date': 'object', 'Stop Date': 'object', '17612': 'object', '17904': 'object', '17914': 'object', '18675': 'object', '18795': 'object'}}
2025-08-14 14:37:07,154 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Start Date': [datetime.date(2024, 8, 19), datetime.date(2024, 8, 26), datetime.date(2024, 9, 2)], 'Stop Date': ['2024-08-25', '2024-09-01', '2024-09-08'], '17612': ['454', '592', '406'], '17904': ['8', '11', '0'], '17914': ['18', '27', '19'], '18675': ['1', '14', '2'], '18795': ['0', '0', '0']}}
2025-08-14 14:37:07,154 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 14:37:07,155 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:37:07,175 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History'}
2025-08-14 14:37:07,575 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_to_write': 52}
2025-08-14 14:37:07,743 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'updated_cells': 364}
2025-08-14 14:37:08,214 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History'}
2025-08-14 14:37:08,215 INFO __main__ --- Daily Shipment Processor finished successfully! ---
2025-08-14 14:39:07,349 INFO settings SERVICE_ACCOUNT_KEY_PATH is set to: C:\Users\NathanNeely\Projects\config\ora-automation-project-dev-25acb5551197.json
2025-08-14 14:39:07,350 INFO settings File exists: True
2025-08-14 14:39:07,350 INFO settings First 100 chars of key file: {
  "type": "service_account",
  "project_id": "ora-automation-project-dev",
  "private_key_id": "64
2025-08-14 14:39:07,838 INFO __main__ --- Starting Daily Shipment Processor ---
2025-08-14 14:39:07,838 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Key from Secret Manager...
2025-08-14 14:39:08,173 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-key'.
2025-08-14 14:39:08,173 INFO src.services.shipstation.api_client Attempting to retrieve ShipStation API Secret from Secret Manager...
2025-08-14 14:39:08,434 INFO src.services.gcp.secret_manager Successfully accessed secret 'shipstation-api-secret'.
2025-08-14 14:39:08,435 INFO __main__ Using rolling 32-day date range: 2025-07-13 to 2025-08-14
2025-08-14 14:39:08,435 INFO src.services.shipstation.api_client Starting raw shipment fetch from 2025-07-13 with includeShipmentItems=true and status='shipped'...
2025-08-14 14:39:08,435 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 14:39:09,172 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 14:39:09,181 INFO src.services.shipstation.api_client Fetched page 1 of 2. Total shipments so far: 500
2025-08-14 14:39:09,182 INFO utils.api_utils Attempting GET request to: https://ssapi.shipstation.com/shipments
2025-08-14 14:39:09,689 INFO utils.api_utils Successfully received response from https://ssapi.shipstation.com/shipments with status code: 200
2025-08-14 14:39:09,692 INFO src.services.shipstation.api_client Fetched page 2 of 2. Total shipments so far: 705
2025-08-14 14:39:09,692 INFO src.services.shipstation.api_client Finished fetching ShipStation shipments. Total retrieved: 705
2025-08-14 14:39:09,694 INFO __main__ Processing 704 non-voided shipments.
2025-08-14 14:39:09,694 INFO __main__ Processing data for Shipped_Items_Data tab...
2025-08-14 14:39:09,694 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Items_Data tab...
2025-08-14 14:39:09,699 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 704 rows.
2025-08-14 14:39:09,700 INFO __main__ Processing data for Shipped_Orders_Data tab...
2025-08-14 14:39:09,700 INFO src.services.data_processing.shipment_processor Processing raw shipment data for Shipped_Orders_Data tab...
2025-08-14 14:39:09,705 INFO src.services.data_processing.shipment_processor Finished processing. Resulting DataFrame has 649 unique order rows.
2025-08-14 14:39:09,706 INFO __main__ Overwriting 'Shipped_Items_Data' tab with 704 rows...
2025-08-14 14:39:09,706 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'SKU - Lot': 'object', 'Quantity Shipped': 'int64', 'Base SKU': 'object'}}
2025-08-14 14:39:09,708 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'SKU - Lot': ['17612 - 250195', '17612 - 250195', '17612 - 250195'], 'Quantity Shipped': [6, 2, 6], 'Base SKU': ['17612', '17612', '17612']}}
2025-08-14 14:39:09,710 DEBUG src.services.google_sheets.api_client {'message': 'Attempting to retrieve Google Sheets service account key from Secret Manager.'}
2025-08-14 14:39:10,052 INFO src.services.gcp.secret_manager Successfully accessed secret 'google-sheets-service-account-key'.
2025-08-14 14:39:10,055 INFO src.services.google_sheets.api_client {'message': 'Google Sheets credentials successfully retrieved and cached.'}
2025-08-14 14:39:10,060 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:39:10,065 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 14:39:10,857 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'rows_to_write': 705}
2025-08-14 14:39:11,090 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data', 'updated_cells': 2820}
2025-08-14 14:39:11,648 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Items_Data'}
2025-08-14 14:39:11,648 INFO __main__ Overwriting 'Shipped_Orders_Data' tab with 649 rows...
2025-08-14 14:39:11,648 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Ship Date': 'object', 'OrderNumber': 'object'}}
2025-08-14 14:39:11,649 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Ship Date': [datetime.date(2025, 7, 14), datetime.date(2025, 7, 14), datetime.date(2025, 7, 14)], 'OrderNumber': ['669495', '669455', '669445']}}
2025-08-14 14:39:11,650 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 14:39:11,651 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:39:11,654 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 14:39:12,073 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'rows_to_write': 650}
2025-08-14 14:39:12,277 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data', 'updated_cells': 1300}
2025-08-14 14:39:12,767 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'Shipped_Orders_Data'}
2025-08-14 14:39:12,767 INFO __main__ Fetching existing 52-week history for update...
2025-08-14 14:39:12,768 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 14:39:12,769 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:39:12,775 DEBUG src.services.google_sheets.api_client {'message': 'Fetching data from Google Sheet', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'range': "'ORA_Weekly_Shipped_History'!A:ZZ"}
2025-08-14 14:39:13,232 INFO src.services.google_sheets.api_client {'message': 'Successfully retrieved data from Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_count': 52}
2025-08-14 14:39:13,245 INFO __main__ Full current_week_items_df for current week:
      Ship Date       SKU - Lot  Quantity Shipped Base SKU
595  2025-08-11  17612 - 250216                 7    17612
596  2025-08-11  17904 - 240276                 1    17904
597  2025-08-11  17612 - 250216                 1    17612
598  2025-08-11  17612 - 250216                 1    17612
599  2025-08-11  17914 - 240286                 6    17914
..          ...             ...               ...      ...
699  2025-08-14  17612 - 250216                 6    17612
700  2025-08-14  17612 - 250216                 6    17612
701  2025-08-14  17904 - 240276                 2    17904
702  2025-08-14   18795 - 11001                 1    18795
703  2025-08-14   18795 - 11001                 1    18795

[109 rows x 4 columns]
2025-08-14 14:39:13,246 INFO __main__ current_week_items_df shape: (109, 4)
2025-08-14 14:39:13,252 INFO __main__ current_week_items_df head:
      Ship Date       SKU - Lot  Quantity Shipped Base SKU
595  2025-08-11  17612 - 250216                 7    17612
596  2025-08-11  17904 - 240276                 1    17904
597  2025-08-11  17612 - 250216                 1    17612
598  2025-08-11  17612 - 250216                 1    17612
599  2025-08-11  17914 - 240286                 6    17914
600  2025-08-11  17612 - 250216                 6    17612
601  2025-08-11  17612 - 250216                 2    17612
602  2025-08-11  17612 - 250216                 2    17612
603  2025-08-11  17612 - 250216                 1    17612
604  2025-08-11  17904 - 240276                 1    17904
2025-08-14 14:39:13,252 INFO __main__ Unique 'Base SKU' values in current_week_items_df: ['17612', '17904', '17914', '18675', '18795']
2025-08-14 14:39:13,253 INFO __main__ Starting incremental update of the 52-week history tab...
2025-08-14 14:39:13,254 INFO __main__ Current week starts on: 2025-08-11
2025-08-14 14:39:13,255 INFO __main__ Unique Ship Dates in daily_items_df: [datetime.date(2025, 7, 14), datetime.date(2025, 7, 15), datetime.date(2025, 7, 16), datetime.date(2025, 7, 17), datetime.date(2025, 7, 18), datetime.date(2025, 7, 21), datetime.date(2025, 7, 22), datetime.date(2025, 7, 23), datetime.date(2025, 7, 24), datetime.date(2025, 7, 25), datetime.date(2025, 7, 28), datetime.date(2025, 7, 29), datetime.date(2025, 7, 30), datetime.date(2025, 7, 31), datetime.date(2025, 8, 1), datetime.date(2025, 8, 4), datetime.date(2025, 8, 5), datetime.date(2025, 8, 6), datetime.date(2025, 8, 7), datetime.date(2025, 8, 8), datetime.date(2025, 8, 11), datetime.date(2025, 8, 12), datetime.date(2025, 8, 13), datetime.date(2025, 8, 14)]
2025-08-14 14:39:13,255 INFO __main__ Min Ship Date: 2025-07-14, Max Ship Date: 2025-08-14
2025-08-14 14:39:13,256 INFO __main__ current_week_items_df shape: (109, 4)
2025-08-14 14:39:13,260 INFO __main__ current_week_items_df head:
      Ship Date       SKU - Lot  Quantity Shipped Base SKU
595  2025-08-11  17612 - 250216                 7    17612
596  2025-08-11  17904 - 240276                 1    17904
597  2025-08-11  17612 - 250216                 1    17612
598  2025-08-11  17612 - 250216                 1    17612
599  2025-08-11  17914 - 240286                 6    17914
600  2025-08-11  17612 - 250216                 6    17612
601  2025-08-11  17612 - 250216                 2    17612
602  2025-08-11  17612 - 250216                 2    17612
603  2025-08-11  17612 - 250216                 1    17612
604  2025-08-11  17904 - 240276                 1    17904
2025-08-14 14:39:13,261 INFO __main__ Unique 'Base SKU' values in current_week_items_df: ['17612', '17904', '17914', '18675', '18795']
2025-08-14 14:39:13,261 INFO __main__ Current week starts on: 2025-08-11
2025-08-14 14:39:13,268 INFO src.services.data_processing.shipment_processor Aggregating weekly shipment history for SKUs: ['17612', '17904', '17914', '18675', '18795']...
2025-08-14 14:39:13,284 INFO src.services.data_processing.shipment_processor Aggregation complete. Final report has 1 weekly rows.
2025-08-14 14:39:13,293 INFO __main__ This is a new week. Appending new week and removing the oldest.
2025-08-14 14:39:13,296 INFO __main__ Overwriting 'ORA_Weekly_Shipped_History' with updated 52-week history...
2025-08-14 14:39:13,298 DEBUG src.services.google_sheets.api_client {'message': 'DataFrame dtypes before upload', 'dtypes': {'Start Date': 'object', 'Stop Date': 'object', '17612': 'object', '17904': 'object', '17914': 'object', '18675': 'object', '18795': 'object'}}
2025-08-14 14:39:13,299 DEBUG src.services.google_sheets.api_client {'message': 'Sample data before upload', 'sample': {'Start Date': [datetime.date(2024, 8, 26), datetime.date(2024, 9, 2), datetime.date(2024, 9, 9)], 'Stop Date': ['2024-09-01', '2024-09-08', '2024-09-15'], '17612': ['592', '406', '442'], '17904': ['11', '0', '0'], '17914': ['27', '19', '24'], '18675': ['14', '2', '2'], '18795': ['0', '0', '0']}}
2025-08-14 14:39:13,300 DEBUG src.services.google_sheets.api_client {'message': 'Using cached Google Sheets credentials.'}
2025-08-14 14:39:13,302 INFO googleapiclient.discovery_cache file_cache is only supported with oauth2client<4.0.0
2025-08-14 14:39:13,320 DEBUG src.services.google_sheets.api_client {'message': 'Clearing existing data in Google Sheet before writing.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History'}
2025-08-14 14:39:13,751 DEBUG src.services.google_sheets.api_client {'message': 'Writing new data to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'rows_to_write': 52}
2025-08-14 14:39:13,973 INFO src.services.google_sheets.api_client {'message': 'Data successfully written to Google Sheet.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History', 'updated_cells': 364}
2025-08-14 14:39:14,419 INFO src.services.google_sheets.api_client {'message': 'Google Sheet formatting applied successfully.', 'sheet_id': '1SMewCScZp0U4QtdXMp8ZhT3oxefzKHu-Hq2BAXtCeoo', 'worksheet': 'ORA_Weekly_Shipped_History'}
2025-08-14 14:39:14,420 INFO __main__ --- Daily Shipment Processor finished successfully! ---
