# cloudbuild.yaml
options:
  logging: CLOUD_LOGGING_ONLY

steps:
# DEBUGGING STEP: List contents of the project for verification
# This comment is outside the args block, so it's fine.
- name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
  entrypoint: 'bash'
  args: ['-c', 'ls -R .']
  dir: .

# Step to deploy shipstation-reporter-function
# This comment is outside the args block, so it's fine.
- name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
  entrypoint: 'bash'
  args:
    - '-c'
    - |
      cp requirements.txt src/
      mv src/shipstation_reporter.py src/main.py
      
      gcloud functions deploy shipstation-reporter-function \
        --runtime python311 \
        --entry-point main \
        --source=./src \
        --trigger-http \
        --allow-unauthenticated \
        --region=us-central1 \
        --memory=256MB \
        --timeout=300s \
        --set-env-vars GCP_PROJECT_ID=ora-automation-project
  dir: .